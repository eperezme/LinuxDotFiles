/*! For license information please see background_service_bundled.js.LICENSE.txt */
(()=>{var t={1227:(t,e,i)=>{e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const i="color: "+this.color;e.splice(1,0,i,"color: inherit");let n=0,s=0;e[0].replace(/%[a-zA-Z%]/g,(t=>{"%%"!==t&&(n++,"%c"===t&&(s=n))})),e.splice(s,0,i)},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){let t;try{t=e.storage.getItem("debug")}catch(t){}!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG);return t},e.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch(t){}}(),e.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.log=console.debug||console.log||(()=>{}),t.exports=i(2447)(e);const{formatters:n}=t.exports;n.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}},2447:(t,e,i)=>{t.exports=function(t){function e(t){let i,s,r,o=null;function a(...t){if(!a.enabled)return;const n=a,s=Number(new Date),r=s-(i||s);n.diff=r,n.prev=i,n.curr=s,i=s,t[0]=e.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let o=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,((i,s)=>{if("%%"===i)return"%";o++;const r=e.formatters[s];if("function"==typeof r){const e=t[o];i=r.call(n,e),t.splice(o,1),o--}return i})),e.formatArgs.call(n,t);(n.log||e.log).apply(n,t)}return a.namespace=t,a.useColors=e.useColors(),a.color=e.selectColor(t),a.extend=n,a.destroy=e.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(s!==e.namespaces&&(s=e.namespaces,r=e.enabled(t)),r),set:t=>{o=t}}),"function"==typeof e.init&&e.init(a),a}function n(t,i){const n=e(this.namespace+(void 0===i?":":i)+t);return n.log=this.log,n}function s(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function(t){if(t instanceof Error)return t.stack||t.message;return t},e.disable=function(){const t=[...e.names.map(s),...e.skips.map(s).map((t=>"-"+t))].join(",");return e.enable(""),t},e.enable=function(t){let i;e.save(t),e.namespaces=t,e.names=[],e.skips=[];const n=("string"==typeof t?t:"").split(/[\s,]+/),s=n.length;for(i=0;i<s;i++)n[i]&&("-"===(t=n[i].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.slice(1)+"$")):e.names.push(new RegExp("^"+t+"$")))},e.enabled=function(t){if("*"===t[t.length-1])return!0;let i,n;for(i=0,n=e.skips.length;i<n;i++)if(e.skips[i].test(t))return!1;for(i=0,n=e.names.length;i<n;i++)if(e.names[i].test(t))return!0;return!1},e.humanize=i(7824),e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach((i=>{e[i]=t[i]})),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(t){let i=0;for(let e=0;e<t.length;e++)i=(i<<5)-i+t.charCodeAt(e),i|=0;return e.colors[Math.abs(i)%e.colors.length]},e.enable(e.load()),e}},7824:t=>{var e=1e3,i=60*e,n=60*i,s=24*n,r=7*s,o=365.25*s;function a(t,e,i,n){var s=e>=1.5*i;return Math.round(t/i)+" "+n+(s?"s":"")}t.exports=function(t,c){c=c||{};var h=typeof t;if("string"===h&&t.length>0)return function(t){if((t=String(t)).length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!a)return;var c=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*o;case"weeks":case"week":case"w":return c*r;case"days":case"day":case"d":return c*s;case"hours":case"hour":case"hrs":case"hr":case"h":return c*n;case"minutes":case"minute":case"mins":case"min":case"m":return c*i;case"seconds":case"second":case"secs":case"sec":case"s":return c*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(t);if("number"===h&&isFinite(t))return c.long?function(t){var r=Math.abs(t);if(r>=s)return a(t,r,s,"day");if(r>=n)return a(t,r,n,"hour");if(r>=i)return a(t,r,i,"minute");if(r>=e)return a(t,r,e,"second");return t+" ms"}(t):function(t){var r=Math.abs(t);if(r>=s)return Math.round(t/s)+"d";if(r>=n)return Math.round(t/n)+"h";if(r>=i)return Math.round(t/i)+"m";if(r>=e)return Math.round(t/e)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}}},e={};function i(n){var s=e[n];if(void 0!==s)return s.exports;var r=e[n]={exports:{}};return t[n](r,r.exports,i),r.exports}i.n=t=>{var e=t&&t.t?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"t",{value:!0})};var n={};(()=>{"use strict";i.d(n,{Z:()=>Do});var t={};i.r(t),i.d(t,{Decoder:()=>te,Encoder:()=>Qt,PacketType:()=>Zt,protocol:()=>Yt});var e=i(1227),s=i.n(e);const r=chrome.runtime.id,o=[".netflix.",".disneyplus.",".hbomax.",".hulu.",".amazon.",".primevideo.",".youtube.",".paramountplus.",".funimation.",".peacocktv.",".crunchyroll.",".fubo.tv",".espn.",".showtime.",".amcplus.",".hotstar.","tv.apple.","tubitv.com",".sling.",".philo."],a="wss://ws.teleparty.com",c="https://wptony1.netflixparty.com",h="https://redirect.teleparty.com",u={apiKey:"AIzaSyDvZJAoFJkT2lBrhloA0e9XwKmLgELTAeQ",authDomain:"teleparty-mobile.firebaseapp.com",projectId:"teleparty-mobile",storageBucket:"teleparty-mobile.appspot.com",messagingSenderId:"961974665980",appId:"1:961974665980:web:fe4179db8591331aeb8d79",measurementId:"G-PC36DK40FL"},l=`${h}/sidebar`,d=`${h}/friends`,f="redirectDataMap",p="https://api.teleparty.com",v="Service_Background",g="Content_Script",m="Failed to read chrome storage. Please refresh the page and try again",w="An unexpected error occured. Please refresh the page and try again.",y=368;chrome.extension.getURL("img/x-circle.svg");class b{constructor(t,e,i,n,s){this.requiredPermissions=t,this.serverName=i,this.name=n,this.contentScripts=e,this.syncFromEnd=s}urlWithSessionId(t){return`https://redirect.teleparty.com/join/${t}`}}var _,I;!function(t){t.NETFLIX="Netflix",t.HULU="Hulu",t.DISNEY_PLUS="Disney",t.HBO_MAX="HBOMax",t.YOUTUBE="Youtube",t.YOUTUBE_TV="YoutubeTV",t.AMAZON="Amazon",t.CRUNCHYROLL="Crunchyroll",t.ESPN="ESPN+",t.PARAMOUNT="Paramount+"}(_||(_={})),function(t){t.EPISODE="episode",t.FEATURE="feature",t.LIVE="live",t.EXTRA="extra",t.OTHER="other"}(I||(I={}));var k=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{c(n.next(t))}catch(t){r(t)}}function a(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){t.done?s(t.value):function(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(o,a)}c((n=n.apply(t,e||[])).next())}))};function S(t){return t.hostname.includes(".netflix.")&&t.pathname.includes("/watch")}function T(t){return t.includes("urn:hbo:feature")?I.FEATURE:t.includes("urn:hbo:episode")||t.includes("urn:hbo:page:")&&t.includes(":type:episode")?I.EPISODE:t.includes("urn:hbo:extra")?I.EXTRA:I.OTHER}function C(t){return function(){return new Promise((e=>{setTimeout((()=>{e()}),t)}))}}function E(t,e,i,n,s){return k(this,void 0,void 0,(function*(){const r=`${p}/${t}`,o=new XMLHttpRequest;if(o.open(e,r),i){if(!s)throw console.error("Passed Token: "+s),new Error("403");o.setRequestHeader("Authorization",`Bearer ${s}`),o.setRequestHeader("Content-Type","application/json")}return new Promise(((t,e)=>{o.addEventListener("readystatechange",(()=>{if(o.readyState===XMLHttpRequest.DONE){const i=o.status;0===i||i>=200&&i<400?t(o.responseText):e(o.responseText)}})),o.send(JSON.stringify(n))}))}))}const A=new class extends b{isValidUrl(t){return S(t)}isBrowsing(t){return t.hostname.includes(".netflix.")}getVideoId(t){const e=t.pathname.match(/^.*\/([0-9]+)\??.*/);return e&&e.length>0?e[1]:void 0}getFullscreenScript(){return'\n            (function() {\n                var sizingWrapper = document.getElementsByClassName("sizing-wrapper")[0];\n                    if (sizingWrapper) {\n                        sizingWrapper.requestFullscreen = function() {}\n                        document.getElementsByClassName(\'button-nfplayerFullscreen\')[0].onclick = function() {\n                            var fullScreenWrapper = document.getElementsByClassName("nf-kb-nav-wrapper")[0];\n                            fullScreenWrapper.webkitRequestFullScreen(fullScreenWrapper.ALLOW_KEYBOARD_INPUT);\n                        }\n                    }\n            })();\n        '}}([],["content_scripts/netflix/netflix_content_bundled.js"],"netflix",_.NETFLIX,!1);Object.freeze(A);const O=A;const N=new class extends b{isValidUrl(t){return function(t){return t.hostname.includes(".hulu.")&&t.pathname.includes("/watch")}(t)}isBrowsing(t){return t.hostname.includes(".hulu.")}getVideoId(t){const e=t.pathname.match(/^.*\/([a-z\-0-9]+)\??.*/);return e&&e.length>0?e[1]:void 0}}([],["content_scripts/hulu/hulu_content_bundled.js"],"hulu",_.HULU,!1);Object.freeze(N);const P=N;const D=new class extends b{isValidUrl(t){return function(t){return t.hostname.includes(".disneyplus.")&&t.pathname.includes("/video")}(t)}isBrowsing(t){return t.hostname.includes(".disneyplus.")}getVideoId(t){const e=t.pathname.match(/^.*\/([a-z\-0-9]+)\??.*/);return e&&e.length>0?e[1]:void 0}}([],["content_scripts/disney/disney_content_bundled.js"],"disney",_.DISNEY_PLUS,!1);Object.freeze(D);const R=D;const F=new class extends b{isValidUrl(t){return function(t){return t.hostname.includes(".hbomax.")&&"other"!==T(t.pathname)||t.pathname.includes("urn:hbo:page")}(t)}isBrowsing(t){return t.hostname.includes(".hbomax.")}getVideoId(t){const e="urn:hbo:"+T(t.pathname)+":",i=t.pathname.split(e);let n=null!=i&&i.length>1&&null!=i[1]?i[1].match(/^([a-zA-Z\-_0-9]+)\??.*/):null;const s=null!=n&&0!==n.length?i[1].match(/^([a-zA-Z\-_0-9]+)\??.*/):void 0;let r=s&&s.length>0?s[1]:void 0;return r||(n=t.pathname.match(/(page:)([a-zA-Z\-_0-9]+)\??.*/),r=null!=n&&3==n.length?n[2]:void 0),r}getVideoType(t){return T(t.pathname)}}([],["content_scripts/hbo_max/hbo_max_content_bundled.js"],"hbomax",_.HBO_MAX,!1);Object.freeze(F);const x=F;const M=new class extends b{isValidUrl(t){return function(t){return t.hostname.includes(".amazon.")||t.hostname.includes(".primevideo.")}(t)}isBrowsing(t){return!1}getVideoId(t){const e=t.pathname.split("ref")[0].match(/^.*\/([a-z\-0-9.A-Z]+)(\?|\/ref)?.*/);return null!=e&&e.length>0?e[1]:void 0}}([],["content_scripts/amazon/amazon_content_bundled.js"],"amazon",_.AMAZON,!1);Object.freeze(M);const L=M;const j=new class extends b{isBrowsing(t){return t.hostname.includes(".crunchyroll.")}isValidUrl(t){return function(t){return t.hostname.includes(".crunchyroll.")}(t)}getVideoId(t){const e=t.pathname.match(/watch\/(.*)\//);return e&&e.length>0?e[1]:void 0}}([],["content_scripts/crunchyroll/crunchyroll_content_bundled.js"],"crunchyroll",_.CRUNCHYROLL,!1);Object.freeze(j);const U=j;const B=new class extends b{isBrowsing(t){return!!t.href.includes("watch?")}isValidUrl(t){return function(t){return!(t.hostname.includes("tv.youtube.com")&&!t.pathname.includes("/watch"))&&t.hostname.includes(".youtube.")}(t)}getVideoId(t){if(t.href.includes("/watch")||t.href.includes("/shorts/")){const e=/(youtu.*be.*)\/(watch\?v=|embed\/|v|shorts|)(.*?((?=[&#?])|$))/gm.exec(t.href);return null!=e&&e.length>3&&e[3]?e[3]:void 0}return"browsing"}}([],["content_scripts/youtube/youtube_content_bundled.js"],"youtube",_.YOUTUBE,!1);Object.freeze(B);const $=B;const W=new class extends b{isBrowsing(t){return t.hostname.includes(".espn.")}isValidUrl(t){return function(t){return t.hostname.includes(".espn.")&&t.pathname.includes("/player")}(t)}getVideoId(t){const e=t.pathname;return e.substring(e.lastIndexOf("/")+1)}}([],["content_scripts/espn/espn_content_bundled.js"],"espn",_.ESPN,!1);Object.freeze(W);const V=W;const G=new class extends b{isBrowsing(t){return t.hostname.includes(".paramountplus.")}isValidUrl(t){return function(t){return t.hostname.includes(".paramountplus.")&&t.pathname.includes("/video")}(t)}getVideoId(t){const e=t.pathname.match(/([^/]+)\/?$/);return e&&e.length>0?e[1]:void 0}}([],["content_scripts/paramount/paramount_content_bundled.js"],"paramount",_.PARAMOUNT,!1);Object.freeze(G);const H=G;class z{constructor(t,e){var i;this.isBrowsing=!1,this.id=e,this.videoId,this.url=t;const n=[O,P,R,x,L,$,U,V,H];for(const e of n){if(e.isValidUrl(this.url)){this.streamingService=e,this.serviceName=e.name,this.videoId=e.getVideoId(t);break}if(e.isBrowsing(this.url)){this.isBrowsing=!0,this.streamingService=e,this.serviceName=e.name;break}}this.sessionIdFromUrl=null!==(i=function(t,e,i){const n="?"+t.split("?")[i];if(void 0===n)return;const s=e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),r=new RegExp("[?|&]"+s+"=([^&]*)(&|$)").exec(n);return null===r||r.length<2?void 0:decodeURIComponent(r[1])}(this.url.href,"npSessionId",1))&&void 0!==i?i:void 0}urlWithSessionId(t){return this.streamingService?this.streamingService.urlWithSessionId(t):void 0}}var J=console.log.bind(window.console);const q=4500;class K{constructor(){this.i=new Map}h(){let t="";for(let e=0;e<16;e+=1)t+="0123456789abcdef"[Math.floor(16*Math.random())];return t}executeCallback(t,e){const i=this.i.get(t);i&&(i(e),this.i.delete(t))}addCallback(t,e){let i=this.h();for(;this.i.has(i);)i=this.h();return this.i.set(i,t),e&&setTimeout((()=>{this.executeCallback(i,{errorMessage:"Could not connect to the server. Please refresh the page and try again."})}),e),i}}const X=Object.create(null);X.open="0",X.close="1",X.ping="2",X.pong="3",X.message="4",X.upgrade="5",X.noop="6";const Y=Object.create(null);Object.keys(X).forEach((t=>{Y[X[t]]=t}));const Z={type:"error",data:"parser error"},Q="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),tt="function"==typeof ArrayBuffer,et=(t,e)=>{const i=new FileReader;return i.onload=function(){const t=i.result.split(",")[1];e("b"+t)},i.readAsDataURL(t)},it=({type:t,data:e},i,n)=>{return Q&&e instanceof Blob?i?n(e):et(e,n):tt&&(e instanceof ArrayBuffer||(s=e,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(s):s&&s.buffer instanceof ArrayBuffer))?i?n(e):et(new Blob([e]),n):n(X[t]+(e||""));var s},nt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",st="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let t=0;t<nt.length;t++)st[nt.charCodeAt(t)]=t;const rt="function"==typeof ArrayBuffer,ot=(t,e)=>{if(rt){const i=(t=>{let e,i,n,s,r,o=.75*t.length,a=t.length,c=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);const h=new ArrayBuffer(o),u=new Uint8Array(h);for(e=0;e<a;e+=4)i=st[t.charCodeAt(e)],n=st[t.charCodeAt(e+1)],s=st[t.charCodeAt(e+2)],r=st[t.charCodeAt(e+3)],u[c++]=i<<2|n>>4,u[c++]=(15&n)<<4|s>>2,u[c++]=(3&s)<<6|63&r;return h})(t);return at(i,e)}return{base64:!0,data:t}},at=(t,e)=>"blob"===e&&t instanceof ArrayBuffer?new Blob([t]):t,ct=(t,e)=>{if("string"!=typeof t)return{type:"message",data:at(t,e)};const i=t.charAt(0);if("b"===i)return{type:"message",data:ot(t.substring(1),e)};return Y[i]?t.length>1?{type:Y[i],data:t.substring(1)}:{type:Y[i]}:Z},ht=String.fromCharCode(30);function ut(t){if(t)return function(t){for(var e in ut.prototype)t[e]=ut.prototype[e];return t}(t)}ut.prototype.on=ut.prototype.addEventListener=function(t,e){return this.u=this.u||{},(this.u["$"+t]=this.u["$"+t]||[]).push(e),this},ut.prototype.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}return i.fn=e,this.on(t,i),this},ut.prototype.off=ut.prototype.removeListener=ut.prototype.removeAllListeners=ut.prototype.removeEventListener=function(t,e){if(this.u=this.u||{},0==arguments.length)return this.u={},this;var i,n=this.u["$"+t];if(!n)return this;if(1==arguments.length)return delete this.u["$"+t],this;for(var s=0;s<n.length;s++)if((i=n[s])===e||i.fn===e){n.splice(s,1);break}return 0===n.length&&delete this.u["$"+t],this},ut.prototype.emit=function(t){this.u=this.u||{};for(var e=new Array(arguments.length-1),i=this.u["$"+t],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(i){n=0;for(var s=(i=i.slice(0)).length;n<s;++n)i[n].apply(this,e)}return this},ut.prototype.emitReserved=ut.prototype.emit,ut.prototype.listeners=function(t){return this.u=this.u||{},this.u["$"+t]||[]},ut.prototype.hasListeners=function(t){return!!this.listeners(t).length};const lt="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function dt(t,...e){return e.reduce(((e,i)=>(t.hasOwnProperty(i)&&(e[i]=t[i]),e)),{})}const ft=setTimeout,pt=clearTimeout;function vt(t,e){e.useNativeTimers?(t.setTimeoutFn=ft.bind(lt),t.clearTimeoutFn=pt.bind(lt)):(t.setTimeoutFn=setTimeout.bind(lt),t.clearTimeoutFn=clearTimeout.bind(lt))}class gt extends Error{constructor(t,e,i){super(t),this.description=e,this.context=i,this.type="TransportError"}}class mt extends ut{constructor(t){super(),this.writable=!1,vt(this,t),this.opts=t,this.query=t.query,this.readyState="",this.socket=t.socket}onError(t,e,i){return super.emitReserved("error",new gt(t,e,i)),this}open(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(t){"open"===this.readyState&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const e=ct(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}}const wt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),yt={};let bt,_t=0,It=0;function kt(t){let e="";do{e=wt[t%64]+e,t=Math.floor(t/64)}while(t>0);return e}function St(){const t=kt(+new Date);return t!==bt?(_t=0,bt=t):t+"."+kt(_t++)}for(;It<64;It++)yt[wt[It]]=It;function Tt(t){let e="";for(let i in t)t.hasOwnProperty(i)&&(e.length&&(e+="&"),e+=encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e}let Ct=!1;try{Ct="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){}const Et=Ct;function At(t){const e=t.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!e||Et))return new XMLHttpRequest}catch(t){}if(!e)try{return new(lt[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}function Ot(){}const Nt=null!=new At({xdomain:!1}).responseType;class Pt extends ut{constructor(t,e){super(),vt(this,e),this.opts=e,this.method=e.method||"GET",this.uri=t,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.create()}create(){const t=dt(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;const e=this.xhr=new At(t);try{e.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0);for(let t in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(t)&&e.setRequestHeader(t,this.opts.extraHeaders[t])}}catch(t){}if("POST"===this.method)try{e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{e.setRequestHeader("Accept","*/*")}catch(t){}"withCredentials"in e&&(e.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(e.timeout=this.opts.requestTimeout),e.onreadystatechange=()=>{4===e.readyState&&(200===e.status||1223===e.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof e.status?e.status:0)}),0))},e.send(this.data)}catch(t){return void this.setTimeoutFn((()=>{this.onError(t)}),0)}"undefined"!=typeof document&&(this.index=Pt.requestsCount++,Pt.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=Ot,t)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete Pt.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}if(Pt.requestsCount=0,Pt.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",Dt);else if("function"==typeof addEventListener){addEventListener("onpagehide"in lt?"pagehide":"unload",Dt,!1)}function Dt(){for(let t in Pt.requests)Pt.requests.hasOwnProperty(t)&&Pt.requests[t].abort()}const Rt="function"==typeof Promise&&"function"==typeof Promise.resolve?t=>Promise.resolve().then(t):(t,e)=>e(t,0),Ft=lt.WebSocket||lt.MozWebSocket,xt="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();const Mt={websocket:class extends mt{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),e=this.opts.protocols,i=xt?{}:dt(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=xt?new Ft(t,e,i):e?new Ft(t,e):new Ft(t)}catch(t){return this.emitReserved("error",t)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws.l.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const i=t[e],n=e===t.length-1;it(i,this.supportsBinary,(t=>{try{this.ws.send(t)}catch(t){}n&&Rt((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let t=this.query||{};const e=this.opts.secure?"wss":"ws";let i="";this.opts.port&&("wss"===e&&443!==Number(this.opts.port)||"ws"===e&&80!==Number(this.opts.port))&&(i=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=St()),this.supportsBinary||(t.b64=1);const n=Tt(t);return e+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+i+this.opts.path+(n.length?"?"+n:"")}check(){return!!Ft}},polling:class extends mt{constructor(t){if(super(t),this.polling=!1,"undefined"!=typeof location){const e="https:"===location.protocol;let i=location.port;i||(i=e?"443":"80"),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||i!==t.port,this.xs=t.secure!==e}const e=t&&t.forceBase64;this.supportsBinary=Nt&&!e}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const e=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let t=0;this.polling&&(t++,this.once("pollComplete",(function(){--t||e()}))),this.writable||(t++,this.once("drain",(function(){--t||e()})))}else e()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){((t,e)=>{const i=t.split(ht),n=[];for(let t=0;t<i.length;t++){const s=ct(i[t],e);if(n.push(s),"error"===s.type)break}return n})(t,this.socket.binaryType).forEach((t=>{if("opening"===this.readyState&&"open"===t.type&&this.onOpen(),"close"===t.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(t)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const t=()=>{this.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}write(t){this.writable=!1,((t,e)=>{const i=t.length,n=new Array(i);let s=0;t.forEach(((t,r)=>{it(t,!1,(t=>{n[r]=t,++s===i&&e(n.join(ht))}))}))})(t,(t=>{this.doWrite(t,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){let t=this.query||{};const e=this.opts.secure?"https":"http";let i="";!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=St()),this.supportsBinary||t.sid||(t.b64=1),this.opts.port&&("https"===e&&443!==Number(this.opts.port)||"http"===e&&80!==Number(this.opts.port))&&(i=":"+this.opts.port);const n=Tt(t);return e+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+i+this.opts.path+(n.length?"?"+n:"")}request(t={}){return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new Pt(this.uri(),t)}doWrite(t,e){const i=this.request({method:"POST",data:t});i.on("success",e),i.on("error",((t,e)=>{this.onError("xhr post error",t,e)}))}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",((t,e)=>{this.onError("xhr poll error",t,e)})),this.pollXhr=t}}},Lt=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,jt=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Ut(t){const e=t,i=t.indexOf("["),n=t.indexOf("]");-1!=i&&-1!=n&&(t=t.substring(0,i)+t.substring(i,n).replace(/:/g,";")+t.substring(n,t.length));let s=Lt.exec(t||""),r={},o=14;for(;o--;)r[jt[o]]=s[o]||"";return-1!=i&&-1!=n&&(r.source=e,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=function(t,e){const i=/\/{2,9}/g,n=e.replace(i,"/").split("/");"/"!=e.substr(0,1)&&0!==e.length||n.splice(0,1);"/"==e.substr(e.length-1,1)&&n.splice(n.length-1,1);return n}(0,r.path),r.queryKey=function(t,e){const i={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,e,n){e&&(i[e]=n)})),i}(0,r.query),r}class Bt extends ut{constructor(t,e={}){super(),t&&"object"==typeof t&&(e=t,t=null),t?(t=Ut(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=Ut(e.host).host),vt(this,e),this.secure=null!=e.secure?e.secure:"undefined"!=typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=e.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},e),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=function(t){let e={},i=t.split("&");for(let t=0,n=i.length;t<n;t++){let n=i[t].split("=");e[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return e}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",(()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())}),!1),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const e=Object.assign({},this.opts.query);e.EIO=4,e.transport=t,this.id&&(e.sid=this.id);const i=Object.assign({},this.opts.transportOptions[t],this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new Mt[t](i)}open(){let t;if(this.opts.rememberUpgrade&&Bt.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(t=>this.onClose("transport close",t)))}probe(t){let e=this.createTransport(t),i=!1;Bt.priorWebsocketSuccess=!1;const n=()=>{i||(e.send([{type:"ping",data:"probe"}]),e.once("packet",(t=>{if(!i)if("pong"===t.type&&"probe"===t.data){if(this.upgrading=!0,this.emitReserved("upgrading",e),!e)return;Bt.priorWebsocketSuccess="websocket"===e.name,this.transport.pause((()=>{i||"closed"!==this.readyState&&(h(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())}))}else{const t=new Error("probe error");t.transport=e.name,this.emitReserved("upgradeError",t)}})))};function s(){i||(i=!0,h(),e.close(),e=null)}const r=t=>{const i=new Error("probe error: "+t);i.transport=e.name,s(),this.emitReserved("upgradeError",i)};function o(){r("transport closed")}function a(){r("socket closed")}function c(t){e&&t.name!==e.name&&s()}const h=()=>{e.removeListener("open",n),e.removeListener("error",r),e.removeListener("close",o),this.off("close",a),this.off("upgrading",c)};e.once("open",n),e.once("error",r),e.once("close",o),this.once("close",a),this.once("upgrading",c),e.open()}onOpen(){if(this.readyState="open",Bt.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){let t=0;const e=this.upgrades.length;for(;t<e;t++)this.probe(this.upgrades[t])}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let i=0;i<this.writeBuffer.length;i++){const n=this.writeBuffer[i].data;if(n&&(t+="string"==typeof(e=n)?function(t){let e=0,i=0;for(let n=0,s=t.length;n<s;n++)e=t.charCodeAt(n),e<128?i+=1:e<2048?i+=2:e<55296||e>=57344?i+=3:(n++,i+=4);return i}(e):Math.ceil(1.33*(e.byteLength||e.size))),i>0&&t>this.maxPayload)return this.writeBuffer.slice(0,i);t+=2}var e;return this.writeBuffer}write(t,e,i){return this.sendPacket("message",t,e,i),this}send(t,e,i){return this.sendPacket("message",t,e,i),this}sendPacket(t,e,i,n){if("function"==typeof e&&(n=e,e=void 0),"function"==typeof i&&(n=i,i=null),"closing"===this.readyState||"closed"===this.readyState)return;(i=i||{}).compress=!1!==i.compress;const s={type:t,data:e,options:i};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),n&&this.once("flush",n),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),t()},i=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?i():t()})):this.upgrading?i():t()),this}onError(t){Bt.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,e){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const e=[];let i=0;const n=t.length;for(;i<n;i++)~this.transports.indexOf(t[i])&&e.push(t[i]);return e}}Bt.protocol=4;Bt.protocol;const $t="function"==typeof ArrayBuffer,Wt=Object.prototype.toString,Vt="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Wt.call(Blob),Gt="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===Wt.call(File);function Ht(t){return $t&&(t instanceof ArrayBuffer||(t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer)(t))||Vt&&t instanceof Blob||Gt&&t instanceof File}function zt(t,e){if(!t||"object"!=typeof t)return!1;if(Array.isArray(t)){for(let e=0,i=t.length;e<i;e++)if(zt(t[e]))return!0;return!1}if(Ht(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return zt(t.toJSON(),!0);for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)&&zt(t[e]))return!0;return!1}function Jt(t){const e=[],i=t.data,n=t;return n.data=qt(i,e),n.attachments=e.length,{packet:n,buffers:e}}function qt(t,e){if(!t)return t;if(Ht(t)){const i={p:!0,num:e.length};return e.push(t),i}if(Array.isArray(t)){const i=new Array(t.length);for(let n=0;n<t.length;n++)i[n]=qt(t[n],e);return i}if("object"==typeof t&&!(t instanceof Date)){const i={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=qt(t[n],e));return i}return t}function Kt(t,e){return t.data=Xt(t.data,e),t.attachments=void 0,t}function Xt(t,e){if(!t)return t;if(t&&!0===t.p){if("number"==typeof t.num&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}if(Array.isArray(t))for(let i=0;i<t.length;i++)t[i]=Xt(t[i],e);else if("object"==typeof t)for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(t[i]=Xt(t[i],e));return t}const Yt=5;var Zt;!function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"}(Zt||(Zt={}));class Qt{constructor(t){this.replacer=t}encode(t){return t.type!==Zt.EVENT&&t.type!==Zt.ACK||!zt(t)?[this.encodeAsString(t)]:(t.type=t.type===Zt.EVENT?Zt.BINARY_EVENT:Zt.BINARY_ACK,this.encodeAsBinary(t))}encodeAsString(t){let e=""+t.type;return t.type!==Zt.BINARY_EVENT&&t.type!==Zt.BINARY_ACK||(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){const e=Jt(t),i=this.encodeAsString(e.packet),n=e.buffers;return n.unshift(i),n}}class te extends ut{constructor(t){super(),this.reviver=t}add(t){let e;if("string"==typeof t){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t),e.type===Zt.BINARY_EVENT||e.type===Zt.BINARY_ACK?(this.reconstructor=new ee(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else{if(!Ht(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e))}}decodeString(t){let e=0;const i={type:Number(t.charAt(0))};if(void 0===Zt[i.type])throw new Error("unknown packet type "+i.type);if(i.type===Zt.BINARY_EVENT||i.type===Zt.BINARY_ACK){const n=e+1;for(;"-"!==t.charAt(++e)&&e!=t.length;);const s=t.substring(n,e);if(s!=Number(s)||"-"!==t.charAt(e))throw new Error("Illegal attachments");i.attachments=Number(s)}if("/"===t.charAt(e+1)){const n=e+1;for(;++e;){if(","===t.charAt(e))break;if(e===t.length)break}i.nsp=t.substring(n,e)}else i.nsp="/";const n=t.charAt(e+1);if(""!==n&&Number(n)==n){const n=e+1;for(;++e;){const i=t.charAt(e);if(null==i||Number(i)!=i){--e;break}if(e===t.length)break}i.id=Number(t.substring(n,e+1))}if(t.charAt(++e)){const n=this.tryParse(t.substr(e));if(!te.isPayloadValid(i.type,n))throw new Error("invalid payload");i.data=n}return i}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(t){return!1}}static isPayloadValid(t,e){switch(t){case Zt.CONNECT:return"object"==typeof e;case Zt.DISCONNECT:return void 0===e;case Zt.CONNECT_ERROR:return"string"==typeof e||"object"==typeof e;case Zt.EVENT:case Zt.BINARY_EVENT:return Array.isArray(e)&&e.length>0;case Zt.ACK:case Zt.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class ee{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const t=Kt(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function ie(t,e,i){return t.on(e,i),function(){t.off(e,i)}}const ne=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class se extends ut{constructor(t,e,i){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,i&&i.auth&&(this.auth=i.auth),this.io.m&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[ie(t,"open",this.onopen.bind(this)),ie(t,"packet",this.onpacket.bind(this)),ie(t,"error",this.onerror.bind(this)),ie(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._||this.io.open(),"open"===this.io.I&&this.onopen()),this}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){if(ne.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');e.unshift(t);const i={type:Zt.EVENT,data:e,options:{}};if(i.options.compress=!1!==this.flags.compress,"function"==typeof e[e.length-1]){const t=this.ids++,n=e.pop();this.k(t,n),i.id=t}const n=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!n||!this.connected)||(this.connected?(this.notifyOutgoingListeners(i),this.packet(i)):this.sendBuffer.push(i)),this.flags={},this}k(t,e){const i=this.flags.timeout;if(void 0===i)return void(this.acks[t]=e);const n=this.io.setTimeoutFn((()=>{delete this.acks[t];for(let e=0;e<this.sendBuffer.length;e++)this.sendBuffer[e].id===t&&this.sendBuffer.splice(e,1);e.call(this,new Error("operation has timed out"))}),i);this.acks[t]=(...t)=>{this.io.clearTimeoutFn(n),e.apply(this,[null,...t])}}packet(t){t.nsp=this.nsp,this.io.S(t)}onopen(){"function"==typeof this.auth?this.auth((t=>{this.packet({type:Zt.CONNECT,data:t})})):this.packet({type:Zt.CONNECT,data:this.auth})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e)}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case Zt.CONNECT:if(t.data&&t.data.sid){const e=t.data.sid;this.onconnect(e)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Zt.EVENT:case Zt.BINARY_EVENT:this.onevent(t);break;case Zt.ACK:case Zt.BINARY_ACK:this.onack(t);break;case Zt.DISCONNECT:this.ondisconnect();break;case Zt.CONNECT_ERROR:this.destroy();const e=new Error(t.data.message);e.data=t.data.data,this.emitReserved("connect_error",e)}}onevent(t){const e=t.data||[];null!=t.id&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this.T&&this.T.length){const e=this.T.slice();for(const i of e)i.apply(this,t)}super.emit.apply(this,t)}ack(t){const e=this;let i=!1;return function(...n){i||(i=!0,e.packet({type:Zt.ACK,id:t,data:n}))}}onack(t){const e=this.acks[t.id];"function"==typeof e&&(e.apply(this,t.data),delete this.acks[t.id])}onconnect(t){this.id=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach((t=>this.emitEvent(t))),this.receiveBuffer=[],this.sendBuffer.forEach((t=>{this.notifyOutgoingListeners(t),this.packet(t)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((t=>t())),this.subs=void 0),this.io.C(this)}disconnect(){return this.connected&&this.packet({type:Zt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this.T=this.T||[],this.T.push(t),this}prependAny(t){return this.T=this.T||[],this.T.unshift(t),this}offAny(t){if(!this.T)return this;if(t){const e=this.T;for(let i=0;i<e.length;i++)if(t===e[i])return e.splice(i,1),this}else this.T=[];return this}listenersAny(){return this.T||[]}onAnyOutgoing(t){return this.A=this.A||[],this.A.push(t),this}prependAnyOutgoing(t){return this.A=this.A||[],this.A.unshift(t),this}offAnyOutgoing(t){if(!this.A)return this;if(t){const e=this.A;for(let i=0;i<e.length;i++)if(t===e[i])return e.splice(i,1),this}else this.A=[];return this}listenersAnyOutgoing(){return this.A||[]}notifyOutgoingListeners(t){if(this.A&&this.A.length){const e=this.A.slice();for(const i of e)i.apply(this,t.data)}}}function re(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}re.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),i=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-i:t+i}return 0|Math.min(t,this.max)},re.prototype.reset=function(){this.attempts=0},re.prototype.setMin=function(t){this.ms=t},re.prototype.setMax=function(t){this.max=t},re.prototype.setJitter=function(t){this.jitter=t};class oe extends ut{constructor(e,i){var n;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(i=e,e=void 0),(i=i||{}).path=i.path||"/socket.io",this.opts=i,vt(this,i),this.reconnection(!1!==i.reconnection),this.reconnectionAttempts(i.reconnectionAttempts||1/0),this.reconnectionDelay(i.reconnectionDelay||1e3),this.reconnectionDelayMax(i.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=i.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new re({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==i.timeout?2e4:i.timeout),this.I="closed",this.uri=e;const s=i.parser||t;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this.m=!1!==i.autoConnect,this.m&&this.open()}reconnection(t){return arguments.length?(this.O=!!t,this):this.O}reconnectionAttempts(t){return void 0===t?this.N:(this.N=t,this)}reconnectionDelay(t){var e;return void 0===t?this.P:(this.P=t,null===(e=this.backoff)||void 0===e||e.setMin(t),this)}randomizationFactor(t){var e;return void 0===t?this.D:(this.D=t,null===(e=this.backoff)||void 0===e||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return void 0===t?this.R:(this.R=t,null===(e=this.backoff)||void 0===e||e.setMax(t),this)}timeout(t){return arguments.length?(this.F=t,this):this.F}maybeReconnectOnOpen(){!this._&&this.O&&0===this.backoff.attempts&&this.reconnect()}open(t){if(~this.I.indexOf("open"))return this;this.engine=new Bt(this.uri,this.opts);const e=this.engine,i=this;this.I="opening",this.skipReconnect=!1;const n=ie(e,"open",(function(){i.onopen(),t&&t()})),s=ie(e,"error",(e=>{i.cleanup(),i.I="closed",this.emitReserved("error",e),t?t(e):i.maybeReconnectOnOpen()}));if(!1!==this.F){const t=this.F;0===t&&n();const i=this.setTimeoutFn((()=>{n(),e.close(),e.emit("error",new Error("timeout"))}),t);this.opts.autoUnref&&i.unref(),this.subs.push((function(){clearTimeout(i)}))}return this.subs.push(n),this.subs.push(s),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this.I="open",this.emitReserved("open");const t=this.engine;this.subs.push(ie(t,"ping",this.onping.bind(this)),ie(t,"data",this.ondata.bind(this)),ie(t,"error",this.onerror.bind(this)),ie(t,"close",this.onclose.bind(this)),ie(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(t){this.onclose("parse error")}}ondecoded(t){this.emitReserved("packet",t)}onerror(t){this.emitReserved("error",t)}socket(t,e){let i=this.nsps[t];return i||(i=new se(this,t,e),this.nsps[t]=i),i}C(t){const e=Object.keys(this.nsps);for(const t of e){if(this.nsps[t].active)return}this.M()}S(t){const e=this.encoder.encode(t);for(let i=0;i<e.length;i++)this.engine.write(e[i],t.options)}cleanup(){this.subs.forEach((t=>t())),this.subs.length=0,this.decoder.destroy()}M(){this.skipReconnect=!0,this._=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this.M()}onclose(t,e){this.cleanup(),this.backoff.reset(),this.I="closed",this.emitReserved("close",t,e),this.O&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this.N)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._=!1;else{const e=this.backoff.duration();this._=!0;const i=this.setTimeoutFn((()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((e=>{e?(t._=!1,t.reconnect(),this.emitReserved("reconnect_error",e)):t.onreconnect()})))}),e);this.opts.autoUnref&&i.unref(),this.subs.push((function(){clearTimeout(i)}))}}onreconnect(){const t=this.backoff.attempts;this._=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const ae={};function ce(t,e){"object"==typeof t&&(e=t,t=void 0);const i=function(t,e="",i){let n=t;i=i||"undefined"!=typeof location&&location,null==t&&(t=i.protocol+"//"+i.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?i.protocol+t:i.host+t),/^(https?|wss?):\/\//.test(t)||(t=void 0!==i?i.protocol+"//"+t:"https://"+t),n=Ut(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const s=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port+e,n.href=n.protocol+"://"+s+(i&&i.port===n.port?"":":"+n.port),n}(t,(e=e||{}).path||"/socket.io"),n=i.source,s=i.id,r=i.path,o=ae[s]&&r in ae[s].nsps;let a;return e.forceNew||e["force new connection"]||!1===e.multiplex||o?a=new oe(n,e):(ae[s]||(ae[s]=new oe(n,e)),a=ae[s]),i.query&&!e.query&&(e.query=i.queryKey),a.socket(i.path,e)}var he;Object.assign(ce,{Manager:oe,Socket:se,io:ce,connect:ce}),function(t){t.CREATE_SESSION="createSession",t.CREATE_TEMP_SESSION="createTempSession",t.JOIN_SESSION="joinSession",t.UPDATE_SESSION="updateSession",t.NEXT_EPISODE_MESSAGE="nextEpisode",t.REBOOT_MESSAGE="reboot",t.SEND_MESSAGE="sendMessage",t.JUMP_TO_NEXT_EPISODE="jumpToNextEpisode",t.BUFFERING_MESSAGE="buffering",t.TYPING_MESSAGE="typing",t.SET_BUFFERING_PRESENCE="setBufferingPresence",t.SET_TYPING_PRESENCE="setTypingPresence",t.BROADCAST_USER_SETTINGS="broadcastUserSettings",t.UPDATE_SETTINGS_MESSAGE="updateSettings",t.SET_ADS_PRESENCE="setAdsPresence",t.GET_SERVER_TIME="getServerTime",t.LEAVE_SESSION="leaveSession",t.SEND_REACTION="sendReaction",t.SEND_GIF="sendGIF",t.SIGN_IN="signIn",t.USER_LIST="userList"}(he||(he={}));var ue=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{c(n.next(t))}catch(t){r(t)}}function a(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){t.done?s(t.value):function(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class le{constructor(t,e,i){this.U=!1,this.B=0,this.$=!1,this.W=!0,this.V=e,this.G=t,this.J=0,this.q=new K,this.K=new WebSocket(this.G),this.X(),this.Y=setTimeout(this.tt.bind(this),5e3),this.et=i}getId(){return this.it}getType(){return void 0!==this.K?"uws":"socket.io"}getTransport(){var t;return void 0!==this.K?"websocket":null===(t=this.nt)||void 0===t?void 0:t.io.engine.transport.name}getSocketStartTime(){return this.st}rt(){return{id:this.getId(),type:this.getType(),transport:this.getTransport(),start_time_ms:this.getSocketStartTime()}}tt(){var t,e;null===(t=this.nt)||void 0===t||t.disconnect(),null===(e=this.K)||void 0===e||e.close(q),console.log("Connect timed out, switching servers");const i={name:"socket_error",action:{description:this.$?"socket.io":"uws failed to connect in time",reason:"connect timed out"},socket_session:this.rt()};Do.logEventForTabId(i,this.et),this.ot()}get dropInToggled(){return this.U}set dropInToggled(t){this.U=t}get sessionId(){return this.ct}get tempSessionId(){return this.ht}set tempSessionId(t){this.ht=t,this.V.loadTempSessionId(t)}loadSessionData(t,e){this.ct=t.sessionId,this.V.loadSessionData(t,e)}clearSessionData(){this.ct=void 0,this.V.clearSessionData()}getCurrentSessionData(){return this.V.getSessionData()}X(){this.K&&(this.K.onmessage=this.ut.bind(this),this.K.onclose=this.lt.bind(this),this.K.onerror=this.dt.bind(this),this.K.onopen=this.ft.bind(this),this.vt=setInterval(this.gt.bind(this),45e3))}wt(){this.nt&&(this.nt.on("connect",(()=>{this.ft()})),this.nt.on("connect_error",(t=>{console.log(`connect_error due to ${t.message}`),J(t);const e={name:"socket_error",action:{description:t.message,reason:"socket reported error."},socket_session:this.rt()};Do.logEventForTabId(e,this.et)})),this.nt.on("disconnect",(t=>{this.yt(),J("Socket io disconnect"),this.vt&&clearInterval(this.vt),J("Websocket lost connection: "+t);const e={name:"socket_close",action:{description:"socket.io socket closed",reason:t},socket_session:this.rt()};if(Do.logEventForTabId(e,this.et),"io client disconnect"!==t)this.ot();else if(this.ct){const t={name:"party_disconnect",action:{reason:"party disconnected manually."},socket_session:this.rt()};Do.logEventForTabId(t,this.et)}})),this.nt.on("message",(t=>{var e;if("ping"===t)null===(e=this.nt)||void 0===e||e.emit("pong");else{const e=JSON.parse(t);this.bt(e)}})))}gt(){var t;1==(null===(t=this.K)||void 0===t?void 0:t.readyState)&&this.K.send(JSON.stringify({type:"ping"}))}ft(){this.st=Date.now(),this.yt();const t={name:"socket_open",socket_session:this.rt()};if(Do.logEventForTabId(t,this.et),this._t){clearTimeout(this._t),this.V.onReconnect();const t={name:"party_reconnect",action:{description:"party reconnected using "+(this.$?"socket.io":"uws")+" after "+this.J+" attempts.",reason:"party reconnected."},socket_session:this.rt()};Do.logEventForTabId(t,this.et)}this.It()}It(){this._t&&clearTimeout(this._t),this._t=void 0,this.J=0}yt(){console.log("Clearing connect timeout"),this.Y&&clearTimeout(this.Y)}lt(t){this.yt();const e={name:"socket_close",action:{description:"uws socket closed",reason:String(t.code)},socket_session:this.rt()};if(Do.logEventForTabId(e,this.et),t.code!==q){if(J("Websocket lost connection"),1007===t.code){const e={sessionId:this.ct,eventType:"socket-close-"+t.code};Do.logOldEventAsync(e)}this.ot()}else{if(this.ct){const t={name:"party_disconnect",action:{reason:"party disconnected manually."},socket_session:this.rt()};Do.logEventForTabId(t,this.et)}J("Websocket connection closed manually")}}kt(){return 1e3*Math.pow(2,this.J)}ot(){if(this.W)if(this.St(),this.J++,this.J>10)this.V.onReconnectFailed();else{let t=this.kt();J("Recreating socket with delay: "+t),void 0===this.it&&this.J<=2&&(t=500),this._t=setTimeout(this.Tt.bind(this),t)}}Tt(){try{this.B>=3||this.J>1?this.$=!this.$:this.$=!1,this.$?this.K=void 0:this.nt=void 0;const t={name:"socket_reconnect_attempt",action:{description:"attempting to reconnect using "+(this.$?"socket.io":"uws"),reason:"reconnecting after socket disconnect"},socket_session:this.rt()};Do.logEventForTabId(t,this.et),this.$?(this.nt=ce("https://socketio.teleparty.com",{reconnection:!1,withCredentials:!0}),this.wt()):(this.K=new WebSocket(this.G),this.X()),this.yt(),this.Y=setTimeout(this.tt.bind(this),5e3)}catch(t){console.warn("Failed to recreate socket: "+(10-this.J)+" attempts remaining")}}St(){this.B+=1}dt(t){J("WebSocket error observed:",t);const e={name:"socket_error",action:{description:"uws socket error",reason:"socket reported error."},socket_session:this.rt()};Do.logEventForTabId(e,this.et)}ut(t){try{const e=JSON.parse(t.data);this.bt(e)}catch(t){J("An error occured while parsing a message from the server")}}bt(t){"userId"===t.type?this.Ct(t.data.userId):t.callbackId?this.q.executeCallback(t.callbackId,t.data):this.V.onMessage(t)}Ct(t){J("User id:  "+t),null==this.it&&(this.it=t,this.V.setUserId(t))}teardown(){var t,e;this.W=!1;try{null===(t=this.K)||void 0===t||t.close(q),null===(e=this.nt)||void 0===e||e.disconnect()}catch(t){}this.it="",this.ct="",this.ht="",this._t&&clearTimeout(this._t),this.vt&&clearInterval(this.vt)}sendMessage(t,e,i){var n,s;let r="null";i&&(r=this.q.addCallback(i));const o=this.Et(t,e,r),a=JSON.stringify(o);this.$?null===(n=this.nt)||void 0===n||n.send(a):null===(s=this.K)||void 0===s||s.send(a)}Et(t,e,i){return{type:t,data:e,callbackId:i}}signIn(t){return ue(this,void 0,void 0,(function*(){return this.sendMessage(he.SIGN_IN,{token:t})}))}getUserIdAsync(){var t;return ue(this,void 0,void 0,(function*(){this._t&&(this.It(),this.Tt());try{return yield function(t,e,i=250){return function(){const n=(new Date).getTime(),s=function(){return t()?Promise.resolve():null!==e&&(new Date).getTime()-n>e?Promise.reject(new Error("delayUntil timed out: "+t)):C(i)().then(s)};return s()}}((()=>null!=this.it),2e4)(),null!==(t=this.it)&&void 0!==t?t:""}catch(t){const e={name:"connection_error",action:{description:t,reason:"failed to get user id"},socket_session:this.rt()};Do.logEventForTabId(e,this.et);const i={sessionId:this.ct,eventType:"connection-fail"};throw Do.logOldEventAsync(i),new Error("Could not connect to the server. Please refresh the page and try again.")}}))}}const de=new class{addListener(t){chrome.runtime.onMessage.addListener(t)}removeListener(t){chrome.runtime.onMessage.removeListener(t)}sendMessageToTabAsync(t,e,i=2e4){return new Promise(((n,s)=>{const r=setTimeout((()=>{s()}),i);try{chrome.tabs.sendMessage(e,t,(e=>{chrome.runtime.lastError&&J(chrome.runtime.lastError.message+JSON.stringify(t)),clearTimeout(r),n(e)}))}catch(t){clearTimeout(r),s(t)}}))}At(t,e){return new Promise(((i,n)=>{let s=null;e&&(s=setTimeout((()=>{n({error:"Send Message Timeout"})}),e));try{chrome.runtime.sendMessage(r,t,(e=>{chrome.runtime.lastError&&console.log(chrome.runtime.lastError.message+JSON.stringify(t)),s&&clearTimeout(s),i(e)}))}catch(t){s&&clearTimeout(s),n(t)}}))}};class fe{constructor(t,e,i){this.sender=t,this.target=e,this.type=i}}class pe extends fe{constructor(t,e,i){super(t,e,i),this.type=i}}var ve,ge;!function(t){t.INIT_CHAT="initChat",t.ON_MESSAGE="onMessage",t.ON_BUFFER="onBuffer",t.ON_TYPING="onTyping",t.ON_WATCHING_ADS="onWatchingAds",t.UPDATE_SETTINGS="updateSettings",t.ON_REACTION="onReaction",t.ON_GIF="onGif",t.ON_LOG_EVENT="onLogEvent",t.USER_LIST="userList"}(ve||(ve={}));class me extends pe{constructor(t,e,i){super(t,e,ve.ON_MESSAGE),this.data=i}}class we extends pe{constructor(t,e,i){super(t,e,ve.ON_REACTION),this.data=i}}class ye extends pe{constructor(t,e,i){super(t,e,ve.UPDATE_SETTINGS),this.data=i}}class be extends pe{constructor(t,e,i){super(t,e,ve.ON_BUFFER),this.data=i}}class _e extends pe{constructor(t,e,i){super(t,e,ve.ON_TYPING),this.data=i}}class Ie extends pe{constructor(t,e,i){super(t,e,ve.ON_WATCHING_ADS),this.data=i}}class ke extends fe{constructor(t,e,i){super(t,e,i),this.type=i}}!function(t){t.UPDATE_SESSION="updateSession",t.NEXT_EPISODE="nextEpisode",t.REBOOT_SESSION="rebootSession",t.GET_SERVER_TIME="getServerTime",t.RELOAD_PARTY="reloadParty"}(ge||(ge={}));class Se extends ke{constructor(t,e,i){super(t,e,ge.UPDATE_SESSION),this.data=i}}const Te=new class{constructor(){this.Ot=new Map}getTabForSessionId(t){for(const e of this.Ot.keys()){const i=this.Ot.get(e);if((null==i?void 0:i.tempSessionId)===t)return e}}getAllSockets(){return this.Ot.values()}setSocketForTabId(t,e){this.Ot.set(t,e)}getSocketForTabId(t){return this.Ot.get(t)}containsSocketForTabId(t){return this.Ot.has(t)}removeSocketForTabId(t){this.Ot.delete(t)}teardown(){this.Ot.forEach((t=>{t.teardown()})),this.Ot.clear()}};Object.freeze(Te);const Ce=Te;class Ee{loadSessionData(t,e){this.Nt=t,this.Nt&&(this.Nt.userSettings=e,this.Nt.messages||(this.Nt.messages=[]))}get sessionData(){return this.Nt}set sessionData(t){this.Nt=t}}class Ae extends ke{constructor(t,e,i){super(t,e,ge.NEXT_EPISODE),this.data=i}}class Oe extends ke{constructor(t,e,i){super(t,e,ge.REBOOT_SESSION),this.data=i}}class Ne extends pe{constructor(t,e,i){super(t,e,ve.ON_GIF),this.data=i}}class Pe extends pe{constructor(t,e,i){super(t,e,ve.USER_LIST),this.data=i}}class De{constructor(t){this.et=t,this.Pt=new Ee}setUserId(t){this.it=t}onMessage(t){switch(t.type){case he.SEND_MESSAGE:this.Dt(t);break;case he.SET_BUFFERING_PRESENCE:this.Rt(t);break;case he.SET_TYPING_PRESENCE:this.Ft(t);break;case he.SET_ADS_PRESENCE:this.xt(t);break;case he.UPDATE_SETTINGS_MESSAGE:this.Mt(t);break;case he.UPDATE_SESSION:this.Lt(t);break;case he.JUMP_TO_NEXT_EPISODE:this.jt(t);break;case he.SEND_REACTION:this.Ut(t);break;case he.SEND_GIF:this.Bt(t);break;case he.USER_LIST:this.$t(t)}}getSessionData(){return this.Pt.sessionData}loadSessionData(t,e){this.Pt.loadSessionData(t,e)}clearSessionData(){this.Pt.sessionData=void 0}loadTempSessionId(t){this.ht=t}onReconnectFailed(){const t=new ke(v,g,ge.RELOAD_PARTY);Ce.removeSocketForTabId(this.et),de.sendMessageToTabAsync(t,this.et)}setDataManager(t){this.Pt=t}onConnect(){J("Connected to server")}onReconnect(){var t;const e=Ce.getSocketForTabId(this.et);this.Pt.sessionData?null==e||e.sendMessage(he.REBOOT_MESSAGE,this.Pt.sessionData,(t=>{if(!t||t.errorMessage)t&&console.log(t.errorMessage),this.onReconnectFailed();else{const e=new Oe(v,g,t);de.sendMessageToTabAsync(e,this.et).then((t=>{t||this.onReconnectFailed()}))}})):this.ht&&(null===(t=window.tpBackground)||void 0===t||t.reToggleOpenParty(this.et))}Dt(t){var e;const i=new me(v,g,t.data);de.sendMessageToTabAsync(i,this.et),null===(e=this.Pt.sessionData)||void 0===e||e.messages.push(i.data)}Rt(t){const e=new be(v,g,t.data);e.data.usersBuffering=e.data.usersBuffering.filter((t=>t!=this.it)),de.sendMessageToTabAsync(e,this.et)}Ft(t){const e=new _e(v,g,t.data);e.data.usersTyping=e.data.usersTyping.filter((t=>t!=this.it)),de.sendMessageToTabAsync(e,this.et)}Ut(t){const e=new we(v,g,t.data);de.sendMessageToTabAsync(e,this.et)}Bt(t){var e;const i=new Ne(v,g,t.data);de.sendMessageToTabAsync(i,this.et),null===(e=this.Pt.sessionData)||void 0===e||e.messages.push(i.data)}xt(t){const e=new Ie(v,g,t.data);e.data.usersWatchingAds=e.data.usersWatchingAds.filter((t=>t!=this.it)),de.sendMessageToTabAsync(e,this.et)}Mt(t){const e=new ye(v,g,t.data);de.sendMessageToTabAsync(e,this.et),this.Pt.sessionData&&this.Pt.sessionData.permId==e.data.permId&&(this.Pt.sessionData.userSettings,e.data.userSettings)}Lt(t){const e=new Se(v,g,t.data);de.sendMessageToTabAsync(e,this.et),this.Pt.sessionData&&(this.Pt.sessionData.state=e.data.state,this.Pt.sessionData.lastKnownTime=e.data.lastKnownTime,this.Pt.sessionData.lastKnownTimeUpdatedAt=e.data.lastKnownTimeUpdatedAt)}jt(t){const e=new Ae(v,g,t.data);de.sendMessageToTabAsync(e,this.et),this.Pt.sessionData&&(this.Pt.sessionData.videoId=e.data.videoId)}$t(t){const e=new Pe(v,g,t.data);de.sendMessageToTabAsync(e,this.et)}}class Re{constructor(t){this.et=t}createSocketForTab(){const t=new De(this.et),e=new le(a,t,this.et);return J("Created Socket with url: "+a),e}}var Fe=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{c(n.next(t))}catch(t){r(t)}}function a(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){t.done?s(t.value):function(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(o,a)}c((n=n.apply(t,e||[])).next())}))};const xe=new class{getItemsAsync(t){return Fe(this,void 0,void 0,(function*(){return new Promise(((e,i)=>{chrome.storage.local.get(t,(t=>{chrome.runtime.lastError?i(new Error(m)):e(t)}))}))}))}getAllItemsAsync(){return Fe(this,void 0,void 0,(function*(){return new Promise(((t,e)=>{chrome.storage.local.get(null,(i=>{chrome.runtime.lastError?e(new Error(m)):t(i)}))}))}))}};Object.freeze(xe);const Me=xe,Le=["Batman.svg","DeadPool.svg","CptAmerica.svg","Wolverine.svg","IronMan.svg","Goofy.svg","Alien.svg","Mulan.svg","Snow-White.svg","Poohbear.svg","Sailormoon.svg","Sailor Cat.svg","Pizza.svg","Cookie.svg","Chocobar.svg","hotdog.svg","Hamburger.svg","Popcorn.svg","IceCream.svg","ChickenLeg.svg"],je=["General/Alien.svg","General/Batman.svg","General/ChickenLeg.svg","General/Chocobar.svg","General/Cookie.svg","General/CptAmerica.svg","General/DeadPool.svg","General/Goofy.svg","General/Hamburger.svg","General/hotdog.svg","General/IceCream.svg","General/IronMan.svg","General/Mulan.svg","General/Pizza.svg","General/Poohbear.svg","General/Popcorn.svg","General/Sailor Cat.svg","General/Sailormoon.svg","General/Snow-White.svg","General/Wolverine.svg"],Ue=["General/Alien.svg","General/Batman.svg","General/ChickenLeg.svg","General/Chocobar.svg","General/Cookie.svg","General/CptAmerica.svg","General/DeadPool.svg","General/Goofy.svg","General/Hamburger.svg","General/hotdog.svg","General/IceCream.svg","General/IronMan.svg","General/Mulan.svg","General/Pizza.svg","General/Poohbear.svg","General/Popcorn.svg","General/Sailor Cat.svg","General/Sailormoon.svg","General/Snow-White.svg","General/Wolverine.svg","Christmas/angel.svg","Christmas/bell.svg","Christmas/box.svg","Christmas/cane.svg","Christmas/flake.svg","Christmas/gingerbread.svg","Christmas/gingerbread_F.svg","Christmas/gingerbread_M.svg","Christmas/gloves_blue.svg","Christmas/gloves_red.svg","Christmas/hat.svg","Christmas/ornament.svg","Christmas/raindeer.svg","Christmas/reef.svg","Christmas/santa_F.svg","Christmas/santa_M.svg","Christmas/snowglobe.svg","Christmas/snowman.svg","Christmas/sock.svg","Christmas/tree.svg","Halloween/bats.svg","Halloween/candy_corn.svg","Halloween/cat_black.svg","Halloween/cat_white.svg","Halloween/coffin.svg","Halloween/eye_ball.svg","Halloween/face_angry.svg","Halloween/face_evil.svg","Halloween/face_silly.svg","Halloween/face_smile.svg","Halloween/frankenstein.svg","Halloween/ghost_F.svg","Halloween/ghost_M.svg","Halloween/gravestone.svg","Halloween/lollipop.svg","Halloween/moon.svg","Halloween/mummy.svg","Halloween/potion.svg","Halloween/pumpkin.svg","Halloween/pumpkin_witch.svg","Halloween/skull_brain.svg","Halloween/skull_candy.svg","Halloween/skull_girl.svg","Halloween/witch_hat.svg","Thanksgiving/acorn.svg","Thanksgiving/bread.svg","Thanksgiving/candles.svg","Thanksgiving/corn.svg","Thanksgiving/drinks.svg","Thanksgiving/maple_leaf.svg","Thanksgiving/plate_chicken.svg","Thanksgiving/pumpkin.svg","Thanksgiving/pumpkin_pie.svg","Thanksgiving/slice_pie.svg","Thanksgiving/sun_flower.svg","Thanksgiving/turkey_face.svg"];var Be=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{c(n.next(t))}catch(t){r(t)}}function a(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){t.done?s(t.value):function(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(o,a)}c((n=n.apply(t,e||[])).next())}))};const $e=new class{setItemsAsync(t){return Be(this,void 0,void 0,(function*(){return new Promise(((e,i)=>{chrome.storage.local.set(t,(()=>{chrome.runtime.lastError?i(new Error("Failed to write to chrome storage. Please refresh the page and try again")):e()}))}))}))}};Object.freeze($e);const We=$e;var Ve=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{c(n.next(t))}catch(t){r(t)}}function a(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){t.done?s(t.value):function(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(o,a)}c((n=n.apply(t,e||[])).next())}))};const Ge=new class{isUserIconValid(t){return!!t&&(t.includes("?newIconUrl=")?Ue.includes(t.split("?newIconUrl=")[1])&&Le.includes(t.split("?newIconUrl=")[0]):Ue.includes(t))}isUserIdValid(t){return"string"==typeof t&&(16===t.length||36===t.length)}isUserNickNameValid(t){return t&&"string"==typeof t&&t.length<20}getDefaultUserIcon(){return je[Math.floor(Math.random()*je.length)]}getDefaultUserNickName(){return""}Wt(t){return Ve(this,void 0,void 0,(function*(){try{yield We.setItemsAsync(t)}catch(t){}}))}getValidatedChromeStorageDataAsync(){return Ve(this,void 0,void 0,(function*(){const t=yield Me.getAllItemsAsync(),e=Ge.validateStorageData(t);return JSON.stringify(t)!==JSON.stringify(e)&&this.Wt(e),e}))}validateStorageData(t){const e="object"==typeof t?Object.assign({},t):{};return e.userIcon&&e.userIcon.includes("?newIconUrl=")&&(e.userIcon=e.userIcon.split("?newIconUrl=")[1]),this.isUserIconValid(e.userIcon)||(e.userIcon=this.getDefaultUserIcon()),this.isUserNickNameValid(e.userNickname)||(e.userNickname=this.getDefaultUserNickName()),e}};Object.freeze(Ge);const He=Ge;var ze=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{c(n.next(t))}catch(t){r(t)}}function a(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){t.done?s(t.value):function(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(o,a)}c((n=n.apply(t,e||[])).next())}))};const Je=new class{getRedirectDataForTabAsync(t){return ze(this,void 0,void 0,(function*(){const e=(yield Me.getItemsAsync([f])).redirectDataMap,i=this.Vt(t);if(e&&e[i]){const t=e[i];if(this.Gt(t))return t}}))}deleteRedirectDataForTabAsync(t){return ze(this,void 0,void 0,(function*(){const e=(yield Me.getItemsAsync([f])).redirectDataMap,i=this.Vt(t);e&&e[i]&&delete e[i],yield We.setItemsAsync({[f]:e})}))}Vt(t){return t}storeRedirectDataForTabAsync(t,e){return ze(this,void 0,void 0,(function*(){const i=this.Vt(e);let n=yield Me.getItemsAsync([f]);n[i]=t,n=this.Ht(n),yield We.setItemsAsync({[f]:n})}))}Ht(t){return function(t,e){const i={};let n;for(n in t)t.hasOwnProperty(n)&&e(t[n])&&(i[n]=t[n]);return i}(t,this.Gt)}Gt(t){const e=t.date;return void 0!==e&&"number"==typeof e&&e<=Date.now()&&Date.now()-e<108e5}};Object.freeze(Je);const qe=Je;var Ke,Xe,Ye,Ze,Qe,ti,ei;!function(t){t.DROPIN_KEY="dropInActive",t.AUTO_ACCEPT_DROPIN="dropInAutoAccept",t.STATUS_TYPE="statusType"}(Ke||(Ke={})),function(t){t.DO_AUTH_SIGN_IN="doAuthSignIn",t.GET_AUTH_TOKEN="getAuthToken",t.SIGN_OUT="signOut"}(Xe||(Xe={}));class ii extends fe{constructor(t,e,i){super(t,e,i),this.type=i}}!function(t){t.JOIN_SESSION="joinSession",t.ACCEPT_DROPIN="acceptDropin",t.SET_STATUS_TYPE="setStatusType",t.GET_STATUS_TYPE="getStatusType",t.GET_VIDEO_DATA="getVideoData",t.LOAD_SESSION="loadSession",t.NO_SESSION_DATA="noSessionData",t.ON_NOTIF="onNotif",t.FORWARD_TO_SIDEBAR="forwardToSidebar",t.TEARDOWN="teardown",t.ON_VIDEO_UPDATE="onVideoUpdate",t.SOCKET_LOST_CONNECTION="socketLostConnection",t.REBOOT="socketReconnect",t.LOG_EVENT="logEvent",t.LOG_EXPERIMENT="logExpirement",t.STAY_ALIVE="stayAlive",t.LOAD_CHAT_WINDOW="loadChatWindow",t.RESET_CHAT_WINDOW="resetChatWindow",t.HIDE_CHAT_WINDOW="hideChatWindow",t.SET_USER_PRESENCE="setUserPresence",t.TOGGLE_OPEN_PARTY="toggleOpenParty",t.GET_ACTIVE_PARTY="getActiveParty",t.GET_TAB_ID="getTabId",t.SET_ACTIVE_PARTY="setActiveParty",t.FULLSCREEN_WINDOW="fullscreenWindow",t.MAX_WINDOW="maxWindow"}(Ye||(Ye={}));class ni extends ii{constructor(t,e,i){super(t,e,Ye.LOAD_SESSION),this.data=i}}!function(t){t.WITH_ACTIVITY="with_activity",t.NO_ACTIVITY="no_activity",t.OFFLINE="offline"}(Ze||(Ze={}));!function(t){t.BROADCAST="brodadcast",t.BROADCAST_NEXT_EPISODE="broadcastNextEpisode",t.SEND_MESSAGE="sendMessage",t.CONTENT_SCRIPT_READY="contentScriptReady",t.CONTENT_SCRIPT_ERROR="contentScriptError",t.TEARDOWN="teardown",t.GET_SESSION_DATA="getSessionData",t.SET_TYPING="setTyping",t.SET_BUFFERING="setBuffering",t.SET_WATCHING_ADS="setWatchingAds",t.BROADCAST_USER_SETTINGS="brodadcastUserSettings",t.SEND_REACTION="sendReaction",t.SEND_GIF="sendGIF"}(Qe||(Qe={}));class si extends fe{constructor(t,e,i){super(t,e,i),this.type=i}}!function(t){t.CREATE_SESSION="createSession",t.RE_INJECT="reInject",t.GET_INIT_DATA="getInitData",t.GET_INIT_USER_SESTTINGS="getInitUserSettings",t.IS_CONTENT_SCRIPT_READY="isContentScriptReady",t.SET_CHAT_VISIBLE="setChatVisible",t.DISCONNECT="teardown",t.CLOSE_POPUP="closePopup",t.GET_SCHEDULED_EVENTS="getScheduledEvents",t.GET_RECENT_SCHEDULED_EVENTS="getRecentScheduledEvents",t.GOOGLE_SIGN_IN="googleSignIn",t.CREATE_SCHEDULED_EVENT="createScheduledEvent",t.DELETE_SCHEDULED_EVENT="deleteScheduledEvent",t.SET_USER_STATUS="SET_USER_STATUS"}(ti||(ti={}));class ri extends si{constructor(t,e){super(t,e,ti.CLOSE_POPUP)}}class oi extends si{constructor(t,e){super(t,e,ti.IS_CONTENT_SCRIPT_READY)}}var ai=new Uint8Array(16);function ci(){if(!ei&&!(ei="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ei(ai)}const hi=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const ui=function(t){return"string"==typeof t&&hi.test(t)};for(var li=[],di=0;di<256;++di)li.push((di+256).toString(16).substr(1));const fi=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(li[t[e+0]]+li[t[e+1]]+li[t[e+2]]+li[t[e+3]]+"-"+li[t[e+4]]+li[t[e+5]]+"-"+li[t[e+6]]+li[t[e+7]]+"-"+li[t[e+8]]+li[t[e+9]]+"-"+li[t[e+10]]+li[t[e+11]]+li[t[e+12]]+li[t[e+13]]+li[t[e+14]]+li[t[e+15]]).toLowerCase();if(!ui(i))throw TypeError("Stringified UUID is invalid");return i};const pi=function(t,e,i){var n=(t=t||{}).random||(t.rng||ci)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){i=i||0;for(var s=0;s<16;++s)e[i+s]=n[s];return e}return fi(n)};function vi(){try{return pi()}catch(t){return""}}var gi;!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.OFFLINE=1]="OFFLINE",t[t.AWAY=2]="AWAY",t[t.ONLINE=3]="ONLINE",t[t.WATCHING_ALONE=4]="WATCHING_ALONE",t[t.WATCHING_IN_PARTY=5]="WATCHING_IN_PARTY"}(gi||(gi={}));const mi={$6:["*://*/*"]};var wi=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{c(n.next(t))}catch(t){r(t)}}function a(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){t.done?s(t.value):function(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class yi{constructor(){this.zt=null,this.Jt(),this.qt(),this.Kt=0,this.Xt=0,this.Yt=0,this.Zt=0,this.Qt=vi(),this.te=vi(),this.ee=Date.now(),this.ie=0,this.ne=new Map}setEventWindow(t){this.zt=t}closeEventWindow(){this.zt&&(this.zt.close(),this.zt=null)}eventPostMessage(t,e){var i;null===(i=this.zt)||void 0===i||i.postMessage(t,e)}addAliveTab(t,e){this.ne.set(t,e)}removeAliveTab(t){const e=this.ne.get(t);e&&clearTimeout(e),this.ne.delete(t)}checkAliveTab(t){return this.ne.has(t)}clearTimeout(t){const e=this.ne.get(t);e&&clearTimeout(e)}getVideoSessionData(){return{id:this.te,start_time_ms:this.Kt,heartbeat_duration_ms:Math.min(this.Zt,yi.MAX_HEARTBEAT),total_duration_ms:this.Yt}}resetVideoSession(){this.te=vi(),this.Kt=Date.now(),this.Xt=Date.now(),this.Yt=0}pauseHeartBeat(){this.Zt=0}resumeHeartBeat(){this.Xt=Date.now(),this.Zt=0}heartBeatProc(){this.Zt=0===this.Xt?Date.now()-this.Kt:Date.now()-this.Xt,this.Yt+=this.Zt,this.Xt=Date.now()}incrementAppSessionEventNumber(){this.ie++}getAppSession(){return{id:this.Qt,start_time_ms:this.ee,event_number:this.ie}}se(){chrome.runtime.reload()}Jt(){chrome.tabs.onUpdated.addListener(this.re.bind(this)),chrome.runtime.onInstalled.addListener(this.oe.bind(this)),chrome.storage.onChanged.addListener(((t,e)=>{console.log("storage change: "+JSON.stringify(t)+" for "+JSON.stringify(e))})),chrome.runtime.onUpdateAvailable.addListener(this.se.bind(this))}oe(t){return wi(this,void 0,void 0,(function*(){if("install"==t.reason){yield C(1e3)();const t=chrome.runtime.getManifest().version;Do.ae({name:"install",action:{description:"install extension for the first time version "+t}}),Do.logOldEventAsync({eventType:"install"}),chrome.tabs.create({url:"https://redirect.teleparty.com/get-started"})}else if("update"==t.reason){const e=chrome.runtime.getManifest().version;if(console.log("Updated from "+t.previousVersion+" to "+e+"!"),"4.0.3"===e){const i={name:"update",action:{description:"Updated from "+t.previousVersion+" to "+e+"!",reason:"Extension version is out of date"}};Do.ae(i)}Do.logOldEventAsync({eventType:"update-"+e});Math.random()<.05&&"3.9.5"===e&&chrome.permissions.contains({origins:mi.$6},(t=>{Do.ae({name:"granted_permissions",action:{description:t?"true":"false"}})}))}}))}getIdleState(){return wi(this,void 0,void 0,(function*(){return new Promise((t=>{chrome.idle?chrome.idle.queryState(600,t):t("active")}))}))}getActiveTabId(){return wi(this,void 0,void 0,(function*(){return new Promise(((t,e)=>{chrome.tabs.query({active:!0,currentWindow:!0},(([i])=>{var n;i?t(null!==(n=i.id)&&void 0!==n?n:0):e()}))}))}))}getOnlineState(){return wi(this,void 0,void 0,(function*(){return"active"!==(yield this.getIdleState())?{status:gi.AWAY}:new Promise((t=>{let e={status:gi.ONLINE};chrome.tabs.query({active:!0,currentWindow:!0},(([i])=>{if(i){const n=i.url;if(n&&i.id){const s=new z(new URL(n),i.id);s.streamingService&&(s.isBrowsing?e={status:gi.WATCHING_ALONE,service:s.serviceName,status_text:"Browsing"}:t(void 0))}}t(e)}))}))}))}ce(t){return 16===t.length||36===t.length}he(){const t=navigator.userAgent.toLowerCase().indexOf("edg")>-1?"edge":"chrome";console.log("browser: "+t);const e="?browser="+t,i=new XMLHttpRequest;i.onreadystatechange=()=>{if(i.readyState==XMLHttpRequest.DONE){const t=i.responseText,e=new Date;this.ce(t)&&(chrome.storage.local.set({userId:t,recentlyUpdated:!0,recentlyUpdated3:!0,date:e.toString()},(function(){console.log("Settings saved")})),chrome.runtime.setUninstallURL("https://www.teleparty.com/uninstall?userId="+t+"&browser=chrome&version="+encodeURIComponent(chrome.runtime.getManifest().version)))}},i.open("GET","https://data3.netflixparty.com/create-userId"+e,!0),i.send(null)}qt(){try{chrome.storage.local.get(null,(t=>{t.userId&&He.isUserIdValid(t.userId)?chrome.runtime.setUninstallURL("https://www.teleparty.com/uninstall?userId="+t.userId+"&browser=chrome&version="+encodeURIComponent(chrome.runtime.getManifest().version)):(console.log("userId undefined/invalid in local storage -> now setting"),this.he())}))}catch(t){console.log("user auth error");const e={name:"error",action:{description:"user auth error",reason:t}};Do.ae(e)}}re(t,e,i){if("loading"===e.status&&Do.ue(i),"complete"==e.status){const t=i.url;if(t&&i.id){const e=new URL(t).hostname,n=new z(new URL(t),i.id),s=n.streamingService;o.some((t=>e.includes(t)))&&chrome.tabs.executeScript(i.id,{file:"ci_bundled.js"}),s&&(this.initContentScriptsAsync(n),n.isBrowsing&&Do.setUserPresence({status:3,service:n.serviceName,status_text:"Browsing"})),(new URL(t).hostname.includes("redirect.teleparty")||new URL(t).hostname.includes("localhost"))&&chrome.tabs.executeScript(i.id,{file:"redirect_injected_bundled.js",allFrames:!0})}else if(chrome.runtime.lastError)return}}initContentScriptsAsync(t){return wi(this,void 0,void 0,(function*(){if(t.streamingService&&!t.isBrowsing){const e=t.streamingService;let i=!1;e.name!=_.CRUNCHYROLL&&e.name!=_.ESPN||(i=!0,yield C(5e3)()),yield new Promise((e=>{chrome.tabs.executeScript(t.id,{file:"lib/tp_libraries_min.js"},e)})),yield new Promise((e=>{chrome.tabs.executeScript(t.id,{code:`\n                        if (!window.teleparty) {\n                            window.teleparty = { tabId: ${t.id} }\n                        }\n                    `},e)})),yield Promise.all(e.contentScripts.map((e=>new Promise((n=>{chrome.tabs.executeScript(t.id,{file:e,allFrames:i},(()=>{n()}))})))));const n=new oi(v,g);yield de.sendMessageToTabAsync(n,t.id)}}))}}yi.MAX_HEARTBEAT=8e4;class bi{constructor(){J("Message forwarder"),this.le()}de(t,e,i){if(t.target===v){if(t.type==Qe.BROADCAST){const n=t;return this.fe(he.UPDATE_SESSION,n.data,e,i),!0}if(t.type==Qe.SEND_MESSAGE){const n=t;return this.fe(he.SEND_MESSAGE,n.data,e,i),!0}if(t.type==Qe.SET_TYPING){const n=t;return this.fe(he.SET_TYPING_PRESENCE,n.data,e,i),!0}if(t.type==Qe.SET_BUFFERING){const n=t;return this.fe(he.SET_BUFFERING_PRESENCE,n.data,e,i),!0}if(t.type==Qe.SET_WATCHING_ADS){const n=t;return this.fe(he.SET_ADS_PRESENCE,n.data,e,i),!0}if(t.type===Qe.BROADCAST_USER_SETTINGS){const n=t;return this.fe(he.BROADCAST_USER_SETTINGS,n.data,e,i),!0}if(t.type===Qe.BROADCAST_NEXT_EPISODE){const n=t;return this.fe(he.NEXT_EPISODE_MESSAGE,n.data,e,i),!0}if(t.type===ge.GET_SERVER_TIME)return this.fe(he.GET_SERVER_TIME,{},e,i),!0;if(t.type==Qe.SEND_REACTION){const n=t;return this.fe(he.SEND_REACTION,n.data,e,i),!0}if(t.type==Qe.SEND_GIF){const n=t;return this.fe(he.SEND_GIF,n.data,e,i),!0}if(t.type==Ye.REBOOT){const e=t,n=Ce.getSocketForTabId(e.data.tabId);return null==n||n.sendMessage(he.REBOOT_MESSAGE,e.data.sessionData,i),J("Attempted to reboot session"),!0}if(t.sender==v&&t.type==Ye.REBOOT){const e=t,n=Ce.getSocketForTabId(e.data.tabId);return null==n||n.sendMessage(he.REBOOT_MESSAGE,e.data.sessionData,i),J("Attempted to reboot session"),!0}}return!1}fe(t,e,i,n){const s=this.pe(i);null==s||s.sendMessage(t,e,n)}pe(t){var e;const i=null===(e=t.tab)||void 0===e?void 0:e.id;return i?Ce.getSocketForTabId(i):void 0}le(){de.addListener(this.de.bind(this))}}const _i=function(t){const e=[];let i=0;for(let n=0;n<t.length;n++){let s=t.charCodeAt(n);s<128?e[i++]=s:s<2048?(e[i++]=s>>6|192,e[i++]=63&s|128):55296==(64512&s)&&n+1<t.length&&56320==(64512&t.charCodeAt(n+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++n)),e[i++]=s>>18|240,e[i++]=s>>12&63|128,e[i++]=s>>6&63|128,e[i++]=63&s|128):(e[i++]=s>>12|224,e[i++]=s>>6&63|128,e[i++]=63&s|128)}return e},Ii={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let e=0;e<t.length;e+=3){const s=t[e],r=e+1<t.length,o=r?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,h=s>>2,u=(3&s)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,r||(l=64)),n.push(i[h],i[u],i[l],i[d])}return n.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(_i(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let i=0,n=0;for(;i<t.length;){const s=t[i++];if(s<128)e[n++]=String.fromCharCode(s);else if(s>191&&s<224){const r=t[i++];e[n++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const r=((7&s)<<18|(63&t[i++])<<12|(63&t[i++])<<6|63&t[i++])-65536;e[n++]=String.fromCharCode(55296+(r>>10)),e[n++]=String.fromCharCode(56320+(1023&r))}else{const r=t[i++],o=t[i++];e[n++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let e=0;e<t.length;){const s=i[t.charAt(e++)],r=e<t.length?i[t.charAt(e)]:0;++e;const o=e<t.length?i[t.charAt(e)]:64;++e;const a=e<t.length?i[t.charAt(e)]:64;if(++e,null==s||null==r||null==o||null==a)throw Error();const c=s<<2|r>>4;if(n.push(c),64!==o){const t=r<<4&240|o>>2;if(n.push(t),64!==a){const t=o<<6&192|a;n.push(t)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},ki=function(t){return function(t){const e=_i(t);return Ii.encodeByteArray(e,!0)}(t).replace(/\./g,"")},Si=function(t){try{return Ii.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};class Ti{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,i)=>{e?this.reject(e):this.resolve(i),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,i))}}}function Ci(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}class Ei extends Error{constructor(t,e,i){super(e),this.code=t,this.customData=i,this.name="FirebaseError",Object.setPrototypeOf(this,Ei.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ai.prototype.create)}}class Ai{constructor(t,e,i){this.service=t,this.serviceName=e,this.errors=i}create(t,...e){const i=e[0]||{},n=`${this.service}/${t}`,s=this.errors[t],r=s?function(t,e){return t.replace(Oi,((t,i)=>{const n=e[i];return null!=n?String(n):`<${i}?>`}))}(s,i):"Error",o=`${this.serviceName}: ${r} (${n}).`;return new Ei(n,o,i)}}const Oi=/\{\$([^}]+)}/g;function Ni(t,e){if(t===e)return!0;const i=Object.keys(t),n=Object.keys(e);for(const s of i){if(!n.includes(s))return!1;const i=t[s],r=e[s];if(Pi(i)&&Pi(r)){if(!Ni(i,r))return!1}else if(i!==r)return!1}for(const t of n)if(!i.includes(t))return!1;return!0}function Pi(t){return null!==t&&"object"==typeof t}function Di(t){const e=[];for(const[i,n]of Object.entries(t))Array.isArray(n)?n.forEach((t=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(t))})):e.push(encodeURIComponent(i)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function Ri(t){const e={};return t.replace(/^\?/,"").split("&").forEach((t=>{if(t){const[i,n]=t.split("=");e[decodeURIComponent(i)]=decodeURIComponent(n)}})),e}function Fi(t){const e=t.indexOf("?");if(!e)return"";const i=t.indexOf("#",e);return t.substring(e,i>0?i:void 0)}class xi{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((()=>{t(this)})).catch((t=>{this.error(t)}))}next(t){this.forEachObserver((e=>{e.next(t)}))}error(t){this.forEachObserver((e=>{e.error(t)})),this.close(t)}complete(){this.forEachObserver((t=>{t.complete()})),this.close()}subscribe(t,e,i){let n;if(void 0===t&&void 0===e&&void 0===i)throw new Error("Missing Observer.");n=function(t,e){if("object"!=typeof t||null===t)return!1;for(const i of e)if(i in t&&"function"==typeof t[i])return!0;return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:i},void 0===n.next&&(n.next=Mi),void 0===n.error&&(n.error=Mi),void 0===n.complete&&(n.complete=Mi);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(t){}})),this.observers.push(n),s}unsubscribeOne(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[t])try{e(this.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))}close(t){this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function Mi(){}function Li(t){return t&&t.ve?t.ve:t}class ji{constructor(t,e,i){this.name=t,this.instanceFactory=e,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const Ui="[DEFAULT]";class Bi{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new Ti;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:e});i&&t.resolve(i)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const i=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),n=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(i)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:i})}catch(t){if(n)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:Ui})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:i});e.resolve(t)}catch(t){}}}}clearInstance(t="[DEFAULT]"){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"ge"in t)).map((t=>t.ge()))])}isComponentSet(){return null!=this.component}isInitialized(t="[DEFAULT]"){return this.instances.has(t)}getOptions(t="[DEFAULT]"){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,i=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:i,options:e});for(const[t,e]of this.instancesDeferred.entries()){i===this.normalizeInstanceIdentifier(t)&&e.resolve(n)}return n}onInit(t,e){var i;const n=this.normalizeInstanceIdentifier(e),s=null!==(i=this.onInitCallbacks.get(n))&&void 0!==i?i:new Set;s.add(t),this.onInitCallbacks.set(n,s);const r=this.instances.get(n);return r&&t(r,n),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const i=this.onInitCallbacks.get(e);if(i)for(const n of i)try{n(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let i=this.instances.get(t);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(n=t,n===Ui?void 0:n),options:e}),this.instances.set(t,i),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(i,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,i)}catch(t){}var n;return i||null}normalizeInstanceIdentifier(t="[DEFAULT]"){return this.component?this.component.multipleInstances?t:Ui:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class $i{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new Bi(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const Wi=[];var Vi;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(Vi||(Vi={}));const Gi={debug:Vi.DEBUG,verbose:Vi.VERBOSE,info:Vi.INFO,warn:Vi.WARN,error:Vi.ERROR,silent:Vi.SILENT},Hi=Vi.INFO,zi={[Vi.DEBUG]:"log",[Vi.VERBOSE]:"log",[Vi.INFO]:"info",[Vi.WARN]:"warn",[Vi.ERROR]:"error"},Ji=(t,e,...i)=>{if(e<t.logLevel)return;const n=(new Date).toISOString(),s=zi[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${n}]  ${t.name}:`,...i)};class qi{constructor(t){this.name=t,this.me=Hi,this.we=Ji,this.ye=null,Wi.push(this)}get logLevel(){return this.me}set logLevel(t){if(!(t in Vi))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this.me=t}setLogLevel(t){this.me="string"==typeof t?Gi[t]:t}get logHandler(){return this.we}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this.we=t}get userLogHandler(){return this.ye}set userLogHandler(t){this.ye=t}debug(...t){this.ye&&this.ye(this,Vi.DEBUG,...t),this.we(this,Vi.DEBUG,...t)}log(...t){this.ye&&this.ye(this,Vi.VERBOSE,...t),this.we(this,Vi.VERBOSE,...t)}info(...t){this.ye&&this.ye(this,Vi.INFO,...t),this.we(this,Vi.INFO,...t)}warn(...t){this.ye&&this.ye(this,Vi.WARN,...t),this.we(this,Vi.WARN,...t)}error(...t){this.ye&&this.ye(this,Vi.ERROR,...t),this.we(this,Vi.ERROR,...t)}}let Ki,Xi;const Yi=new WeakMap,Zi=new WeakMap,Qi=new WeakMap,tn=new WeakMap,en=new WeakMap;let nn={get(t,e,i){if(t instanceof IDBTransaction){if("done"===e)return Zi.get(t);if("objectStoreNames"===e)return t.objectStoreNames||Qi.get(t);if("store"===e)return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return on(t[e])},set:(t,e,i)=>(t[e]=i,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function sn(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Xi||(Xi=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(an(this),e),on(Yi.get(this))}:function(...e){return on(t.apply(an(this),e))}:function(e,...i){const n=t.call(an(this),e,...i);return Qi.set(n,e.sort?e.sort():[e]),on(n)}}function rn(t){return"function"==typeof t?sn(t):(t instanceof IDBTransaction&&function(t){if(Zi.has(t))return;const e=new Promise(((e,i)=>{const n=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",r),t.removeEventListener("abort",r)},s=()=>{e(),n()},r=()=>{i(t.error||new DOMException("AbortError","AbortError")),n()};t.addEventListener("complete",s),t.addEventListener("error",r),t.addEventListener("abort",r)}));Zi.set(t,e)}(t),e=t,(Ki||(Ki=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((t=>e instanceof t))?new Proxy(t,nn):t);var e}function on(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,i)=>{const n=()=>{t.removeEventListener("success",s),t.removeEventListener("error",r)},s=()=>{e(on(t.result)),n()},r=()=>{i(t.error),n()};t.addEventListener("success",s),t.addEventListener("error",r)}));return e.then((e=>{e instanceof IDBCursor&&Yi.set(e,t)})).catch((()=>{})),en.set(e,t),e}(t);if(tn.has(t))return tn.get(t);const e=rn(t);return e!==t&&(tn.set(t,e),en.set(e,t)),e}const an=t=>en.get(t);const cn=["get","getKey","getAll","getAllKeys","count"],hn=["put","add","delete","clear"],un=new Map;function ln(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(un.get(e))return un.get(e);const i=e.replace(/FromIndex$/,""),n=e!==i,s=hn.includes(i);if(!(i in(n?IDBIndex:IDBObjectStore).prototype)||!s&&!cn.includes(i))return;const r=async function(t,...e){const r=this.transaction(t,s?"readwrite":"readonly");let o=r.store;return n&&(o=o.index(e.shift())),(await Promise.all([o[i](...e),s&&r.done]))[0]};return un.set(e,r),r}nn=(t=>({...t,get:(e,i,n)=>ln(e,i)||t.get(e,i,n),has:(e,i)=>!!ln(e,i)||t.has(e,i)}))(nn);class dn{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const fn="@firebase/app",pn="0.7.33",vn=new qi("@firebase/app"),gn="[DEFAULT]",mn={[fn]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},wn=new Map,yn=new Map;function bn(t,e){try{t.container.addComponent(e)}catch(i){vn.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,i)}}function _n(t){const e=t.name;if(yn.has(e))return vn.debug(`There were multiple attempts to register component ${e}.`),!1;yn.set(e,t);for(const e of wn.values())bn(e,t);return!0}function In(t,e){const i=t.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),t.container.getProvider(e)}const kn=new Ai("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class Sn{constructor(t,e,i){this.be=!1,this._e=Object.assign({},t),this.Ie=Object.assign({},e),this.ke=e.name,this.Se=e.automaticDataCollectionEnabled,this.Te=i,this.container.addComponent(new ji("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this.Se}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this.Se=t}get name(){return this.checkDestroyed(),this.ke}get options(){return this.checkDestroyed(),this._e}get config(){return this.checkDestroyed(),this.Ie}get container(){return this.Te}get isDeleted(){return this.be}set isDeleted(t){this.be=t}checkDestroyed(){if(this.isDeleted)throw kn.create("app-deleted",{appName:this.ke})}}const Tn="9.10.0";function Cn(t,e,i){var n;let s=null!==(n=mn[t])&&void 0!==n?n:t;i&&(s+=`-${i}`);const r=s.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const t=[`Unable to register library "${s}" with version "${e}":`];return r&&t.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void vn.warn(t.join(" "))}_n(new ji(`${s}-version`,(()=>({library:s,version:e})),"VERSION"))}const En="firebase-heartbeat-store";let An=null;function On(){return An||(An=function(t,e,{blocked:i,upgrade:n,blocking:s,terminated:r}={}){const o=indexedDB.open(t,e),a=on(o);return n&&o.addEventListener("upgradeneeded",(t=>{n(on(o.result),t.oldVersion,t.newVersion,on(o.transaction))})),i&&o.addEventListener("blocked",(()=>i())),a.then((t=>{r&&t.addEventListener("close",(()=>r())),s&&t.addEventListener("versionchange",(()=>s()))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(t,e)=>{if(0===e)t.createObjectStore(En)}}).catch((t=>{throw kn.create("idb-open",{originalErrorMessage:t.message})}))),An}async function Nn(t,e){var i;try{const i=(await On()).transaction(En,"readwrite"),n=i.objectStore(En);return await n.put(e,Pn(t)),i.done}catch(t){if(t instanceof Ei)vn.warn(t.message);else{const e=kn.create("idb-set",{originalErrorMessage:null===(i=t)||void 0===i?void 0:i.message});vn.warn(e.message)}}}function Pn(t){return`${t.name}!${t.options.appId}`}class Dn{constructor(t){this.container=t,this.Ce=null;const e=this.container.getProvider("app").getImmediate();this.Ee=new Fn(e),this.Ae=this.Ee.read().then((t=>(this.Ce=t,t)))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=Rn();if(null===this.Ce&&(this.Ce=await this.Ae),this.Ce.lastSentHeartbeatDate!==e&&!this.Ce.heartbeats.some((t=>t.date===e)))return this.Ce.heartbeats.push({date:e,agent:t}),this.Ce.heartbeats=this.Ce.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this.Ee.overwrite(this.Ce)}async getHeartbeatsHeader(){if(null===this.Ce&&await this.Ae,null===this.Ce||0===this.Ce.heartbeats.length)return"";const t=Rn(),{heartbeatsToSend:e,unsentEntries:i}=function(t,e=1024){const i=[];let n=t.slice();for(const s of t){const t=i.find((t=>t.agent===s.agent));if(t){if(t.dates.push(s.date),xn(i)>e){t.dates.pop();break}}else if(i.push({agent:s.agent,dates:[s.date]}),xn(i)>e){i.pop();break}n=n.slice(1)}return{heartbeatsToSend:i,unsentEntries:n}}(this.Ce.heartbeats),n=ki(JSON.stringify({version:2,heartbeats:e}));return this.Ce.lastSentHeartbeatDate=t,i.length>0?(this.Ce.heartbeats=i,await this.Ee.overwrite(this.Ce)):(this.Ce.heartbeats=[],this.Ee.overwrite(this.Ce)),n}}function Rn(){return(new Date).toISOString().substring(0,10)}class Fn{constructor(t){this.app=t,this.Oe=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return"object"==typeof indexedDB&&new Promise(((t,e)=>{try{let i=!0;const n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=()=>{s.result.close(),i||self.indexedDB.deleteDatabase(n),t(!0)},s.onupgradeneeded=()=>{i=!1},s.onerror=()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this.Oe){return await async function(t){var e;try{return(await On()).transaction(En).objectStore(En).get(Pn(t))}catch(t){if(t instanceof Ei)vn.warn(t.message);else{const i=kn.create("idb-get",{originalErrorMessage:null===(e=t)||void 0===e?void 0:e.message});vn.warn(i.message)}}}(this.app)||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this.Oe){const i=await this.read();return Nn(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:i.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this.Oe){const i=await this.read();return Nn(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...t.heartbeats]})}}}function xn(t){return ki(JSON.stringify({version:2,heartbeats:t})).length}var Mn;Mn="",_n(new ji("platform-logger",(t=>new dn(t)),"PRIVATE")),_n(new ji("heartbeat",(t=>new Dn(t)),"PRIVATE")),Cn(fn,pn,Mn),Cn(fn,pn,"esm2017"),Cn("fire-js","");function Ln(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(t);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s])&&(i[n[s]]=t[n[s]])}return i}Object.create;Object.create;function jn(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Un=jn,Bn=new Ai("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),$n=new qi("@firebase/auth");function Wn(t,...e){$n.logLevel<=Vi.ERROR&&$n.error(`Auth (9.10.0): ${t}`,...e)}function Vn(t,...e){throw Jn(t,...e)}function Gn(t,...e){return Jn(t,...e)}function Hn(t,e,i){const n=Object.assign(Object.assign({},Un()),{[e]:i});return new Ai("auth","Firebase",n).create(e,{appName:t.name})}function zn(t,e,i){if(!(e instanceof i))throw i.name!==e.constructor.name&&Vn(t,"argument-error"),Hn(t,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Jn(t,...e){if("string"!=typeof t){const i=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=t.name),t.Ne.create(i,...n)}return Bn.create(t,...e)}function qn(t,e,...i){if(!t)throw Jn(e,...i)}function Kn(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Wn(e),new Error(e)}function Xn(t,e){t||Kn(e)}const Yn=new Map;function Zn(t){Xn(t instanceof Function,"Expected a class definition");let e=Yn.get(t);return e?(Xn(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Yn.set(t,e),e)}function Qn(){var t;return"undefined"!=typeof self&&(null===(t=self.location)||void 0===t?void 0:t.href)||""}function ts(){return"http:"===es()||"https:"===es()}function es(){var t;return"undefined"!=typeof self&&(null===(t=self.location)||void 0===t?void 0:t.protocol)||null}function is(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(ts()||function(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()||"connection"in navigator))||navigator.onLine}class ns{constructor(t,e){this.shortDelay=t,this.longDelay=e,Xn(e>t,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ci())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return is()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function ss(t,e){Xn(t.emulator,"Emulator should always be set here");const{url:i}=t.emulator;return e?`${i}${e.startsWith("/")?e.slice(1):e}`:i}class rs{static initialize(t,e,i){this.fetchImpl=t,e&&(this.headersImpl=e),i&&(this.responseImpl=i)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void Kn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void Kn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void Kn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const os={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},as=new ns(3e4,6e4);function cs(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function hs(t,e,i,n,s={}){return us(t,s,(async()=>{let s={},r={};n&&("GET"===e?r=n:s={body:JSON.stringify(n)});const o=Di(Object.assign({key:t.config.apiKey},r)).slice(1),a=await t.Pe();return a["Content-Type"]="application/json",t.languageCode&&(a["X-Firebase-Locale"]=t.languageCode),rs.fetch()(ds(t,t.config.apiHost,i,o),Object.assign({method:e,headers:a,referrerPolicy:"no-referrer"},s))}))}async function us(t,e,i){t.De=!1;const n=Object.assign(Object.assign({},os),e);try{const e=new fs(t),s=await Promise.race([i(),e.promise]);e.clearNetworkTimeout();const r=await s.json();if("needConfirmation"in r)throw ps(t,"account-exists-with-different-credential",r);if(s.ok&&!("errorMessage"in r))return r;{const e=s.ok?r.errorMessage:r.error.message,[i,o]=e.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===i)throw ps(t,"credential-already-in-use",r);if("EMAIL_EXISTS"===i)throw ps(t,"email-already-in-use",r);if("USER_DISABLED"===i)throw ps(t,"user-disabled",r);const a=n[i]||i.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw Hn(t,a,o);Vn(t,a)}}catch(e){if(e instanceof Ei)throw e;Vn(t,"network-request-failed")}}async function ls(t,e,i,n,s={}){const r=await hs(t,e,i,n,s);return"mfaPendingCredential"in r&&Vn(t,"multi-factor-auth-required",{Re:r}),r}function ds(t,e,i,n){const s=`${e}${i}?${n}`;return t.config.emulator?ss(t.config,s):`${t.config.apiScheme}://${s}`}class fs{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise(((t,e)=>{this.timer=setTimeout((()=>e(Gn(this.auth,"network-request-failed"))),as.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function ps(t,e,i){const n={appName:t.name};i.email&&(n.email=i.email),i.phoneNumber&&(n.phoneNumber=i.phoneNumber);const s=Gn(t,e,n);return s.customData.Fe=i,s}function vs(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch(t){}}function gs(t){return 1e3*Number(t)}function ms(t){var e;const[i,n,s]=t.split(".");if(void 0===i||void 0===n||void 0===s)return Wn("JWT malformed, contained fewer than 3 sections"),null;try{const t=Si(n);return t?JSON.parse(t):(Wn("Failed to decode base64 JWT payload"),null)}catch(t){return Wn("Caught error parsing JWT payload as JSON",null===(e=t)||void 0===e?void 0:e.toString()),null}}async function ws(t,e,i=!1){if(i)return e;try{return await e}catch(e){throw e instanceof Ei&&function({code:t}){return"auth/user-disabled"===t||"auth/user-token-expired"===t}(e)&&t.auth.currentUser===t&&await t.auth.signOut(),e}}class ys{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}xe(){this.isRunning||(this.isRunning=!0,this.schedule())}Me(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(t){var e;if(t){const t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}{this.errorBackoff=3e4;const t=(null!==(e=this.user.stsTokenManager.expirationTime)&&void 0!==e?e:0)-Date.now()-3e5;return Math.max(0,t)}}schedule(t=!1){if(!this.isRunning)return;const e=this.getInterval(t);this.timerId=setTimeout((async()=>{await this.iteration()}),e)}async iteration(){var t;try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null===(t=e)||void 0===t?void 0:t.code)&&this.schedule(!0))}this.schedule()}}class bs{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this.Le()}Le(){this.lastSignInTime=vs(this.lastLoginAt),this.creationTime=vs(this.createdAt)}je(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this.Le()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function _s(t){var e;const i=t.auth,n=await t.getIdToken(),s=await ws(t,async function(t,e){return hs(t,"POST","/v1/accounts:lookup",e)}(i,{idToken:n}));qn(null==s?void 0:s.users.length,i,"internal-error");const r=s.users[0];t.Ue(r);const o=(null===(e=r.providerUserInfo)||void 0===e?void 0:e.length)?r.providerUserInfo.map((t=>{var{providerId:e}=t,i=Ln(t,["providerId"]);return{providerId:e,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})):[];const a=(c=t.providerData,h=o,[...c.filter((t=>!h.some((e=>e.providerId===t.providerId)))),...h]);var c,h;const u=t.isAnonymous,l=!(t.email&&r.passwordHash||(null==a?void 0:a.length)),d=!!u&&l,f={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new bs(r.createdAt,r.lastLoginAt),isAnonymous:d};Object.assign(t,f)}class Is{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){qn(t.idToken,"internal-error"),qn(void 0!==t.idToken,"internal-error"),qn(void 0!==t.refreshToken,"internal-error");const e="expiresIn"in t&&void 0!==t.expiresIn?Number(t.expiresIn):function(t){const e=ms(t);return qn(e,"internal-error"),qn(void 0!==e.exp,"internal-error"),qn(void 0!==e.iat,"internal-error"),Number(e.exp)-Number(e.iat)}(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}async getToken(t,e=!1){return qn(!this.accessToken||this.refreshToken,t,"user-token-expired"),e||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(t,e){const{accessToken:i,refreshToken:n,expiresIn:s}=await async function(t,e){const i=await us(t,{},(async()=>{const i=Di({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:n,apiKey:s}=t.config,r=ds(t,n,"/v1/token",`key=${s}`),o=await t.Pe();return o["Content-Type"]="application/x-www-form-urlencoded",rs.fetch()(r,{method:"POST",headers:o,body:i})}));return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}(t,e);this.updateTokensAndExpiration(i,n,Number(s))}updateTokensAndExpiration(t,e,i){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+1e3*i}static fromJSON(t,e){const{refreshToken:i,accessToken:n,expirationTime:s}=e,r=new Is;return i&&(qn("string"==typeof i,"internal-error",{appName:t}),r.refreshToken=i),n&&(qn("string"==typeof n,"internal-error",{appName:t}),r.accessToken=n),s&&(qn("number"==typeof s,"internal-error",{appName:t}),r.expirationTime=s),r}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}Be(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}$e(){return Object.assign(new Is,this.toJSON())}We(){return Kn("not implemented")}}function ks(t,e){qn("string"==typeof t||void 0===t,"internal-error",{appName:e})}class Ss{constructor(t){var{uid:e,auth:i,stsTokenManager:n}=t,s=Ln(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ys(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=i,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new bs(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(t){const e=await ws(this,this.stsTokenManager.getToken(this.auth,t));return qn(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth.Ve(this),this.auth.Ge(this)),e}getIdTokenResult(t){return async function(t,e=!1){const i=Li(t),n=await i.getIdToken(e),s=ms(n);qn(s&&s.exp&&s.auth_time&&s.iat,i.auth,"internal-error");const r="object"==typeof s.firebase?s.firebase:void 0,o=null==r?void 0:r.sign_in_provider;return{claims:s,token:n,authTime:vs(gs(s.auth_time)),issuedAtTime:vs(gs(s.iat)),expirationTime:vs(gs(s.exp)),signInProvider:o||null,signInSecondFactor:(null==r?void 0:r.sign_in_second_factor)||null}}(this,t)}reload(){return async function(t){const e=Li(t);await _s(e),await e.auth.Ve(e),e.auth.Ge(e)}(this)}Be(t){this!==t&&(qn(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map((t=>Object.assign({},t))),this.metadata.je(t.metadata),this.stsTokenManager.Be(t.stsTokenManager))}$e(t){return new Ss(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager.$e()}))}He(t){qn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this.Ue(this.reloadUserInfo),this.reloadUserInfo=null)}Ue(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}ze(){this.proactiveRefresh.xe()}Je(){this.proactiveRefresh.Me()}async qe(t,e=!1){let i=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),i=!0),e&&await _s(this),await this.auth.Ve(this),i&&this.auth.Ge(this)}async delete(){const t=await this.getIdToken();return await ws(this,async function(t,e){return hs(t,"POST","/v1/accounts:delete",e)}(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((t=>Object.assign({},t))),stsTokenManager:this.stsTokenManager.toJSON(),Ke:this.Ke},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static Xe(t,e){var i,n,s,r,o,a,c,h;const u=null!==(i=e.displayName)&&void 0!==i?i:void 0,l=null!==(n=e.email)&&void 0!==n?n:void 0,d=null!==(s=e.phoneNumber)&&void 0!==s?s:void 0,f=null!==(r=e.photoURL)&&void 0!==r?r:void 0,p=null!==(o=e.tenantId)&&void 0!==o?o:void 0,v=null!==(a=e.Ke)&&void 0!==a?a:void 0,g=null!==(c=e.createdAt)&&void 0!==c?c:void 0,m=null!==(h=e.lastLoginAt)&&void 0!==h?h:void 0,{uid:w,emailVerified:y,isAnonymous:b,providerData:_,stsTokenManager:I}=e;qn(w&&I,t,"internal-error");const k=Is.fromJSON(this.name,I);qn("string"==typeof w,t,"internal-error"),ks(u,t.name),ks(l,t.name),qn("boolean"==typeof y,t,"internal-error"),qn("boolean"==typeof b,t,"internal-error"),ks(d,t.name),ks(f,t.name),ks(p,t.name),ks(v,t.name),ks(g,t.name),ks(m,t.name);const S=new Ss({uid:w,auth:t,email:l,emailVerified:y,displayName:u,isAnonymous:b,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:k,createdAt:g,lastLoginAt:m});return _&&Array.isArray(_)&&(S.providerData=_.map((t=>Object.assign({},t)))),v&&(S.Ke=v),S}static async Ye(t,e,i=!1){const n=new Is;n.updateFromServerResponse(e);const s=new Ss({uid:e.localId,auth:t,stsTokenManager:n,isAnonymous:i});return await _s(s),s}}class Ts{constructor(){this.type="NONE",this.storage={}}async Ze(){return!0}async Qe(t,e){this.storage[t]=e}async ti(t){const e=this.storage[t];return void 0===e?null:e}async ei(t){delete this.storage[t]}ii(t,e){}ni(t,e){}}Ts.type="NONE";const Cs=Ts;function Es(t,e,i){return`firebase:${t}:${e}:${i}`}class As{constructor(t,e,i){this.persistence=t,this.auth=e,this.userKey=i;const{config:n,name:s}=this.auth;this.fullUserKey=Es(this.userKey,n.apiKey,s),this.fullPersistenceKey=Es("persistence",n.apiKey,s),this.boundEventHandler=e.si.bind(e),this.persistence.ii(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence.Qe(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence.ti(this.fullUserKey);return t?Ss.Xe(this.auth,t):null}removeCurrentUser(){return this.persistence.ei(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence.Qe(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const e=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=t,e?this.setCurrentUser(e):void 0}delete(){this.persistence.ni(this.fullUserKey,this.boundEventHandler)}static async create(t,e,i="authUser"){if(!e.length)return new As(Zn(Cs),t,i);const n=(await Promise.all(e.map((async t=>{if(await t.Ze())return t})))).filter((t=>t));let s=n[0]||Zn(Cs);const r=Es(i,t.config.apiKey,t.name);let o=null;for(const i of e)try{const e=await i.ti(r);if(e){const n=Ss.Xe(t,e);i!==s&&(o=n),s=i;break}}catch(t){}const a=n.filter((t=>t.ri));return s.ri&&a.length?(s=a[0],o&&await s.Qe(r,o.toJSON()),await Promise.all(e.map((async t=>{if(t!==s)try{await t.ei(r)}catch(t){}}))),new As(s,t,i)):new As(s,t,i)}}function Os(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Rs(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Ns(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(xs(e))return"Blackberry";if(Ms(e))return"Webos";if(Ps(e))return"Safari";if((e.includes("chrome/")||Ds(e))&&!e.includes("edge/"))return"Chrome";if(Fs(e))return"Android";{const e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=t.match(e);if(2===(null==i?void 0:i.length))return i[1]}return"Other"}function Ns(t=Ci()){return/firefox\//i.test(t)}function Ps(t=Ci()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Ds(t=Ci()){return/crios\//i.test(t)}function Rs(t=Ci()){return/iemobile/i.test(t)}function Fs(t=Ci()){return/android/i.test(t)}function xs(t=Ci()){return/blackberry/i.test(t)}function Ms(t=Ci()){return/webos/i.test(t)}function Ls(t=Ci()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function js(){return function(){const t=Ci();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}()&&10===document.documentMode}function Us(t=Ci()){return Ls(t)||Fs(t)||Ms(t)||xs(t)||/windows phone/i.test(t)||Rs(t)}function Bs(t,e=[]){let i;switch(t){case"Browser":i=Os(Ci());break;case"Worker":i=`${Os(Ci())}-${t}`;break;default:i=t}return`${i}/JsCore/9.10.0/${e.length?e.join(","):"FirebaseCore-web"}`}class $s{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){const i=e=>new Promise(((i,n)=>{try{i(t(e))}catch(t){n(t)}}));i.onAbort=e,this.queue.push(i);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(t){var e;if(this.auth.currentUser===t)return;const i=[];try{for(const e of this.queue)await e(t),e.onAbort&&i.push(e.onAbort)}catch(t){i.reverse();for(const t of i)try{t()}catch(t){}throw this.auth.Ne.create("login-blocked",{originalMessage:null===(e=t)||void 0===e?void 0:e.message})}}}class Ws{constructor(t,e,i){this.app=t,this.heartbeatServiceProvider=e,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Gs(this),this.idTokenSubscription=new Gs(this),this.beforeStateQueue=new $s(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.De=!0,this.oi=!1,this.ai=!1,this.ci=null,this.hi=null,this.Ne=Bn,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=i.sdkClientVersion}ui(t,e){return e&&(this.hi=Zn(e)),this.ci=this.queue((async()=>{var i,n;if(!this.ai&&(this.persistenceManager=await As.create(this,t),!this.ai)){if(null===(i=this.hi)||void 0===i?void 0:i.li)try{await this.hi.di(this)}catch(t){}await this.initializeCurrentUser(e),this.lastNotifiedUid=(null===(n=this.currentUser)||void 0===n?void 0:n.uid)||null,this.ai||(this.oi=!0)}})),this.ci}async si(){if(this.ai)return;const t=await this.assertedPersistence.getCurrentUser();return this.currentUser||t?this.currentUser&&t&&this.currentUser.uid===t.uid?(this.fi.Be(t),void await this.currentUser.getIdToken()):void await this.pi(t,!0):void 0}async initializeCurrentUser(t){var e;const i=await this.assertedPersistence.getCurrentUser();let n=i,s=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const i=null===(e=this.redirectUser)||void 0===e?void 0:e.Ke,r=null==n?void 0:n.Ke,o=await this.tryRedirectSignIn(t);i&&i!==r||!(null==o?void 0:o.user)||(n=o.user,s=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n.Ke){if(s)try{await this.beforeStateQueue.runMiddleware(n)}catch(t){n=i,this.hi.vi(this,(()=>Promise.reject(t)))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return qn(this.hi,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser.Ke===n.Ke?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(t){let e=null;try{e=await this.hi.gi(this,t,!0)}catch(t){await this.mi(null)}return e}async reloadAndSetCurrentUserOrClear(t){var e;try{await _s(t)}catch(t){if("auth/network-request-failed"!==(null===(e=t)||void 0===e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}()}async ge(){this.ai=!0}async updateCurrentUser(t){const e=t?Li(t):null;return e&&qn(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this.pi(e&&e.$e(this))}async pi(t,e=!1){if(!this.ai)return t&&qn(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||await this.beforeStateQueue.runMiddleware(t),this.queue((async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this.hi)&&await this.mi(null),this.pi(null,!0)}setPersistence(t){return this.queue((async()=>{await this.assertedPersistence.setPersistence(Zn(t))}))}wi(){return this.assertedPersistence.persistence.type}yi(t){this.Ne=new Ai("auth","Firebase",t())}onAuthStateChanged(t,e,i){return this.registerStateListener(this.authStateSubscription,t,e,i)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,i){return this.registerStateListener(this.idTokenSubscription,t,e,i)}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(t=this.fi)||void 0===t?void 0:t.toJSON()}}async mi(t,e){const i=await this.getOrInitRedirectPersistenceManager(e);return null===t?i.removeCurrentUser():i.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const e=t&&Zn(t)||this.hi;qn(e,this,"argument-error"),this.redirectPersistenceManager=await As.create(this,[Zn(e.bi)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _i(t){var e,i;return this.oi&&await this.queue((async()=>{})),(null===(e=this.fi)||void 0===e?void 0:e.Ke)===t?this.fi:(null===(i=this.redirectUser)||void 0===i?void 0:i.Ke)===t?this.redirectUser:null}async Ve(t){if(t===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(t)))}Ge(t){t===this.currentUser&&this.notifyAuthListeners()}Ii(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}ze(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this.fi.ze()}Je(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this.fi.Je()}get fi(){return this.currentUser}notifyAuthListeners(){var t,e;if(!this.oi)return;this.idTokenSubscription.next(this.currentUser);const i=null!==(e=null===(t=this.currentUser)||void 0===t?void 0:t.uid)&&void 0!==e?e:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,i,n){if(this.ai)return()=>{};const s="function"==typeof e?e:e.next.bind(e),r=this.oi?Promise.resolve():this.ci;return qn(r,this,"internal-error"),r.then((()=>s(this.currentUser))),"function"==typeof e?t.addObserver(e,i,n):t.addObserver(e)}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this.fi.Je(),t&&this.isProactiveRefreshEnabled&&t.ze(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return qn(this.persistenceManager,this,"internal-error"),this.persistenceManager}ki(t){t&&!this.frameworks.includes(t)&&(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=Bs(this.config.clientPlatform,this.Si()))}Si(){return this.frameworks}async Pe(){var t;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const i=await(null===(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader());return i&&(e["X-Firebase-Client"]=i),e}}function Vs(t){return Li(t)}class Gs{constructor(t){this.auth=t,this.observer=null,this.addObserver=function(t,e){const i=new xi(t,e);return i.subscribe.bind(i)}((t=>this.observer=t))}get next(){return qn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}class Hs{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return Kn("not implemented")}Ti(t){return Kn("not implemented")}Ci(t,e){return Kn("not implemented")}Ei(t){return Kn("not implemented")}}async function zs(t,e){return hs(t,"POST","/v1/accounts:update",e)}class Js extends Hs{constructor(t,e,i,n=null){super("password",i),this.Ai=t,this.Oi=e,this.Ni=n}static Pi(t,e){return new Js(t,e,"password")}static Di(t,e,i=null){return new Js(t,e,"emailLink",i)}toJSON(){return{email:this.Ai,password:this.Oi,signInMethod:this.signInMethod,tenantId:this.Ni}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t;if((null==e?void 0:e.email)&&(null==e?void 0:e.password)){if("password"===e.signInMethod)return this.Pi(e.email,e.password);if("emailLink"===e.signInMethod)return this.Di(e.email,e.password,e.tenantId)}return null}async Ti(t){switch(this.signInMethod){case"password":return async function(t,e){return ls(t,"POST","/v1/accounts:signInWithPassword",cs(t,e))}(t,{returnSecureToken:!0,email:this.Ai,password:this.Oi});case"emailLink":return async function(t,e){return ls(t,"POST","/v1/accounts:signInWithEmailLink",cs(t,e))}(t,{email:this.Ai,oobCode:this.Oi});default:Vn(t,"internal-error")}}async Ci(t,e){switch(this.signInMethod){case"password":return zs(t,{idToken:e,returnSecureToken:!0,email:this.Ai,password:this.Oi});case"emailLink":return async function(t,e){return ls(t,"POST","/v1/accounts:signInWithEmailLink",cs(t,e))}(t,{idToken:e,email:this.Ai,oobCode:this.Oi});default:Vn(t,"internal-error")}}Ei(t){return this.Ti(t)}}async function qs(t,e){return ls(t,"POST","/v1/accounts:signInWithIdp",cs(t,e))}class Ks extends Hs{constructor(){super(...arguments),this.pendingToken=null}static Ri(t){const e=new Ks(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(e.idToken=t.idToken),t.accessToken&&(e.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(e.nonce=t.nonce),t.pendingToken&&(e.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(e.accessToken=t.oauthToken,e.secret=t.oauthTokenSecret):Vn("argument-error"),e}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t,{providerId:i,signInMethod:n}=e,s=Ln(e,["providerId","signInMethod"]);if(!i||!n)return null;const r=new Ks(i,n);return r.idToken=s.idToken||void 0,r.accessToken=s.accessToken||void 0,r.secret=s.secret,r.nonce=s.nonce,r.pendingToken=s.pendingToken||null,r}Ti(t){return qs(t,this.buildRequest())}Ci(t,e){const i=this.buildRequest();return i.idToken=e,qs(t,i)}Ei(t){const e=this.buildRequest();return e.autoCreate=!1,qs(t,e)}buildRequest(){const t={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const e={};this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=Di(e)}return t}}const Xs={USER_NOT_FOUND:"user-not-found"};class Ys extends Hs{constructor(t){super("phone","phone"),this.params=t}static Fi(t,e){return new Ys({verificationId:t,verificationCode:e})}static xi(t,e){return new Ys({phoneNumber:t,temporaryProof:e})}Ti(t){return async function(t,e){return ls(t,"POST","/v1/accounts:signInWithPhoneNumber",cs(t,e))}(t,this.Mi())}Ci(t,e){return async function(t,e){const i=await ls(t,"POST","/v1/accounts:signInWithPhoneNumber",cs(t,e));if(i.temporaryProof)throw ps(t,"account-exists-with-different-credential",i);return i}(t,Object.assign({idToken:e},this.Mi()))}Ei(t){return async function(t,e){return ls(t,"POST","/v1/accounts:signInWithPhoneNumber",cs(t,Object.assign(Object.assign({},e),{operation:"REAUTH"})),Xs)}(t,this.Mi())}Mi(){const{temporaryProof:t,phoneNumber:e,verificationId:i,verificationCode:n}=this.params;return t&&e?{temporaryProof:t,phoneNumber:e}:{sessionInfo:i,code:n}}toJSON(){const t={providerId:this.providerId};return this.params.phoneNumber&&(t.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(t.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(t.verificationCode=this.params.verificationCode),this.params.verificationId&&(t.verificationId=this.params.verificationId),t}static fromJSON(t){"string"==typeof t&&(t=JSON.parse(t));const{verificationId:e,verificationCode:i,phoneNumber:n,temporaryProof:s}=t;return i||e||n||s?new Ys({verificationId:e,verificationCode:i,phoneNumber:n,temporaryProof:s}):null}}class Zs{constructor(t){var e,i,n,s,r,o;const a=Ri(Fi(t)),c=null!==(e=a.apiKey)&&void 0!==e?e:null,h=null!==(i=a.oobCode)&&void 0!==i?i:null,u=function(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(n=a.mode)&&void 0!==n?n:null);qn(c&&h&&u,"argument-error"),this.apiKey=c,this.operation=u,this.code=h,this.continueUrl=null!==(s=a.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(r=a.languageCode)&&void 0!==r?r:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(t){const e=function(t){const e=Ri(Fi(t)).link,i=e?Ri(Fi(e)).deep_link_id:null,n=Ri(Fi(t)).deep_link_id;return(n?Ri(Fi(n)).link:null)||n||i||e||t}(t);try{return new Zs(e)}catch(t){return null}}}class Qs{constructor(){this.providerId=Qs.PROVIDER_ID}static credential(t,e){return Js.Pi(t,e)}static credentialWithLink(t,e){const i=Zs.parseLink(e);return qn(i,"argument-error"),Js.Di(t,i.code,i.tenantId)}}Qs.PROVIDER_ID="password",Qs.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Qs.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class tr{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}class er extends tr{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}class ir extends er{constructor(){super("facebook.com")}static credential(t){return Ks.Ri({providerId:ir.PROVIDER_ID,signInMethod:ir.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return ir.credentialFromTaggedObject(t)}static credentialFromError(t){return ir.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({Fe:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return ir.credential(t.oauthAccessToken)}catch(t){return null}}}ir.FACEBOOK_SIGN_IN_METHOD="facebook.com",ir.PROVIDER_ID="facebook.com";class nr extends er{constructor(){super("google.com"),this.addScope("profile")}static credential(t,e){return Ks.Ri({providerId:nr.PROVIDER_ID,signInMethod:nr.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:e})}static credentialFromResult(t){return nr.credentialFromTaggedObject(t)}static credentialFromError(t){return nr.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({Fe:t}){if(!t)return null;const{oauthIdToken:e,oauthAccessToken:i}=t;if(!e&&!i)return null;try{return nr.credential(e,i)}catch(t){return null}}}nr.GOOGLE_SIGN_IN_METHOD="google.com",nr.PROVIDER_ID="google.com";class sr extends er{constructor(){super("github.com")}static credential(t){return Ks.Ri({providerId:sr.PROVIDER_ID,signInMethod:sr.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return sr.credentialFromTaggedObject(t)}static credentialFromError(t){return sr.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({Fe:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return sr.credential(t.oauthAccessToken)}catch(t){return null}}}sr.GITHUB_SIGN_IN_METHOD="github.com",sr.PROVIDER_ID="github.com";class rr extends er{constructor(){super("twitter.com")}static credential(t,e){return Ks.Ri({providerId:rr.PROVIDER_ID,signInMethod:rr.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:e})}static credentialFromResult(t){return rr.credentialFromTaggedObject(t)}static credentialFromError(t){return rr.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({Fe:t}){if(!t)return null;const{oauthAccessToken:e,oauthTokenSecret:i}=t;if(!e||!i)return null;try{return rr.credential(e,i)}catch(t){return null}}}rr.TWITTER_SIGN_IN_METHOD="twitter.com",rr.PROVIDER_ID="twitter.com";class or{constructor(t){this.user=t.user,this.providerId=t.providerId,this.Fe=t.Fe,this.operationType=t.operationType}static async Ye(t,e,i,n=!1){const s=await Ss.Ye(t,i,n),r=ar(i);return new or({user:s,providerId:r,Fe:i,operationType:e})}static async Li(t,e,i){await t.qe(i,!0);const n=ar(i);return new or({user:t,providerId:n,Fe:i,operationType:e})}}function ar(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class cr extends Ei{constructor(t,e,i,n){var s;super(e.code,e.message),this.operationType=i,this.user=n,Object.setPrototypeOf(this,cr.prototype),this.customData={appName:t.name,tenantId:null!==(s=t.tenantId)&&void 0!==s?s:void 0,Re:e.customData.Re,operationType:i}}static ji(t,e,i,n){return new cr(t,e,i,n)}}function hr(t,e,i,n){return("reauthenticate"===e?i.Ei(t):i.Ti(t)).catch((i=>{if("auth/multi-factor-auth-required"===i.code)throw cr.ji(t,i,e,n);throw i}))}async function ur(t,e,i=!1){const n=await ws(t,e.Ci(t.auth,await t.getIdToken()),i);return or.Li(t,"link",n)}async function lr(t,e,i=!1){var n;const{auth:s}=t,r="reauthenticate";try{const n=await ws(t,hr(s,r,e,t),i);qn(n.idToken,s,"internal-error");const o=ms(n.idToken);qn(o,s,"internal-error");const{sub:a}=o;return qn(t.uid===a,s,"user-mismatch"),or.Li(t,r,n)}catch(t){throw"auth/user-not-found"===(null===(n=t)||void 0===n?void 0:n.code)&&Vn(s,"user-mismatch"),t}}async function dr(t,e,i=!1){const n="signIn",s=await hr(t,n,e),r=await or.Ye(t,n,s);return i||await t.pi(r.user),r}new WeakMap;const fr="__sak";class pr{constructor(t,e){this.storageRetriever=t,this.type=e}Ze(){try{return this.storage?(this.storage.setItem(fr,"1"),this.storage.removeItem(fr),Promise.resolve(!0)):Promise.resolve(!1)}catch(t){return Promise.resolve(!1)}}Qe(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}ti(t){const e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}ei(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}class vr extends pr{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(t,e)=>this.onStorageEvent(t,e),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const t=Ci();return Ps(t)||Ls(t)}()&&function(){try{return!(!window||window===window.top)}catch(t){return!1}}(),this.fallbackToPolling=Us(),this.ri=!0}forAllChangedKeys(t){for(const e of Object.keys(this.listeners)){const i=this.storage.getItem(e),n=this.localCache[e];i!==n&&t(e,n,i)}}onStorageEvent(t,e=!1){if(!t.key)return void this.forAllChangedKeys(((t,e,i)=>{this.notifyListeners(t,i)}));const i=t.key;if(e?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const n=this.storage.getItem(i);if(t.newValue!==n)null!==t.newValue?this.storage.setItem(i,t.newValue):this.storage.removeItem(i);else if(this.localCache[i]===t.newValue&&!e)return}const n=()=>{const t=this.storage.getItem(i);(e||this.localCache[i]!==t)&&this.notifyListeners(i,t)},s=this.storage.getItem(i);js()&&s!==t.newValue&&t.newValue!==t.oldValue?setTimeout(n,10):n()}notifyListeners(t,e){this.localCache[t]=e;const i=this.listeners[t];if(i)for(const t of Array.from(i))t(e?JSON.parse(e):e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((t,e,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:e,newValue:i}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}ii(t,e){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(e)}ni(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async Qe(t,e){await super.Qe(t,e),this.localCache[t]=JSON.stringify(e)}async ti(t){const e=await super.ti(t);return this.localCache[t]=JSON.stringify(e),e}async ei(t){await super.ei(t),delete this.localCache[t]}}vr.type="LOCAL";const gr=vr;class mr extends pr{constructor(){super((()=>window.sessionStorage),"SESSION")}ii(t,e){}ni(t,e){}}mr.type="SESSION";const wr=mr;class yr{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static Ui(t){const e=this.receivers.find((e=>e.isListeningto(t)));if(e)return e;const i=new yr(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const e=t,{eventId:i,eventType:n,data:s}=e.data,r=this.handlersMap[n];if(!(null==r?void 0:r.size))return;e.ports[0].postMessage({status:"ack",eventId:i,eventType:n});const o=Array.from(r).map((async t=>t(e.origin,s))),a=await function(t){return Promise.all(t.map((async t=>{try{return{fulfilled:!0,value:await t}}catch(t){return{fulfilled:!1,reason:t}}})))}(o);e.ports[0].postMessage({status:"done",eventId:i,eventType:n,response:a})}Bi(t,e){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(e)}$i(t,e){this.handlersMap[t]&&e&&this.handlersMap[t].delete(e),e&&0!==this.handlersMap[t].size||delete this.handlersMap[t],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function br(t="",e=10){let i="";for(let t=0;t<e;t++)i+=Math.floor(10*Math.random());return t+i}yr.receivers=[];class _r{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async Wi(t,e,i=50){const n="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!n)throw new Error("connection_unavailable");let s,r;return new Promise(((o,a)=>{const c=br("",20);n.port1.start();const h=setTimeout((()=>{a(new Error("unsupported_event"))}),i);r={messageChannel:n,onMessage(t){const e=t;if(e.data.eventId===c)switch(e.data.status){case"ack":clearTimeout(h),s=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(s),o(e.data.response);break;default:clearTimeout(h),clearTimeout(s),a(new Error("invalid_response"))}}},this.handlers.add(r),n.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:t,eventId:c,data:e},[n.port2])})).finally((()=>{r&&this.removeMessageHandler(r)}))}}function Ir(){return window}function kr(){return void 0!==Ir().WorkerGlobalScope&&"function"==typeof Ir().importScripts}const Sr="firebaseLocalStorageDb",Tr="firebaseLocalStorage",Cr="fbase_key";class Er{constructor(t){this.request=t}toPromise(){return new Promise(((t,e)=>{this.request.addEventListener("success",(()=>{t(this.request.result)})),this.request.addEventListener("error",(()=>{e(this.request.error)}))}))}}function Ar(t,e){return t.transaction([Tr],e?"readwrite":"readonly").objectStore(Tr)}function Or(){const t=indexedDB.open(Sr,1);return new Promise(((e,i)=>{t.addEventListener("error",(()=>{i(t.error)})),t.addEventListener("upgradeneeded",(()=>{const e=t.result;try{e.createObjectStore(Tr,{keyPath:Cr})}catch(t){i(t)}})),t.addEventListener("success",(async()=>{const i=t.result;i.objectStoreNames.contains(Tr)?e(i):(i.close(),await function(){const t=indexedDB.deleteDatabase(Sr);return new Er(t).toPromise()}(),e(await Or()))}))}))}async function Nr(t,e,i){const n=Ar(t,!0).put({[Cr]:e,value:i});return new Er(n).toPromise()}function Pr(t,e){const i=Ar(t,!0).delete(e);return new Er(i).toPromise()}class Dr{constructor(){this.type="LOCAL",this.ri=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this.Vi=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async Gi(){return this.db||(this.db=await Or()),this.db}async Hi(t){let e=0;for(;;)try{const e=await this.Gi();return await t(e)}catch(t){if(e++>3)throw t;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return kr()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=yr.Ui(kr()?self:null),this.receiver.Bi("keyChanged",(async(t,e)=>({keyProcessed:(await this.zi()).includes(e.key)}))),this.receiver.Bi("ping",(async(t,e)=>["keyChanged"]))}async initializeSender(){var t,e;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(t){return null}}(),!this.activeServiceWorker)return;this.sender=new _r(this.activeServiceWorker);const i=await this.sender.Wi("ping",{},800);i&&(null===(t=i[0])||void 0===t?void 0:t.fulfilled)&&(null===(e=i[0])||void 0===e?void 0:e.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){var e;if(this.sender&&this.activeServiceWorker&&((null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null)===this.activeServiceWorker)try{await this.sender.Wi("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async Ze(){try{if(!indexedDB)return!1;const t=await Or();return await Nr(t,fr,"1"),await Pr(t,fr),!0}catch(t){}return!1}async Ji(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async Qe(t,e){return this.Ji((async()=>(await this.Hi((i=>Nr(i,t,e))),this.localCache[t]=e,this.notifyServiceWorker(t))))}async ti(t){const e=await this.Hi((e=>async function(t,e){const i=Ar(t,!1).get(e),n=await new Er(i).toPromise();return void 0===n?null:n.value}(e,t)));return this.localCache[t]=e,e}async ei(t){return this.Ji((async()=>(await this.Hi((e=>Pr(e,t))),delete this.localCache[t],this.notifyServiceWorker(t))))}async zi(){const t=await this.Hi((t=>{const e=Ar(t,!1).getAll();return new Er(e).toPromise()}));if(!t)return[];if(0!==this.pendingWrites)return[];const e=[],i=new Set;for(const{fbase_key:n,value:s}of t)i.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(s)&&(this.notifyListeners(n,s),e.push(n));for(const t of Object.keys(this.localCache))this.localCache[t]&&!i.has(t)&&(this.notifyListeners(t,null),e.push(t));return e}notifyListeners(t,e){this.localCache[t]=e;const i=this.listeners[t];if(i)for(const t of Array.from(i))t(e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this.zi()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}ii(t,e){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this.ti(t)),this.listeners[t].add(e)}ni(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Dr.type="LOCAL";const Rr=Dr;function Fr(t){return new Promise(((e,i)=>{const n=document.createElement("script");var s,r;n.setAttribute("src",t),n.onload=e,n.onerror=t=>{const e=Gn("internal-error");e.customData=t,i(e)},n.type="text/javascript",n.charset="UTF-8",(null!==(r=null===(s=document.getElementsByTagName("head"))||void 0===s?void 0:s[0])&&void 0!==r?r:document).appendChild(n)}))}function xr(t){return`__${t}${Math.floor(1e6*Math.random())}`}xr("rcb"),new ns(3e4,6e4);const Mr="recaptcha";async function Lr(t,e,i){var n;const s=await i.verify();try{let r;if(qn("string"==typeof s,t,"argument-error"),qn(i.type===Mr,t,"argument-error"),r="string"==typeof e?{phoneNumber:e}:e,"session"in r){const e=r.session;if("phoneNumber"in r){qn("enroll"===e.type,t,"internal-error");const i=await function(t,e){return hs(t,"POST","/v2/accounts/mfaEnrollment:start",cs(t,e))}(t,{idToken:e.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,recaptchaToken:s}});return i.phoneSessionInfo.sessionInfo}{qn("signin"===e.type,t,"internal-error");const i=(null===(n=r.multiFactorHint)||void 0===n?void 0:n.uid)||r.multiFactorUid;qn(i,t,"missing-multi-factor-info");const o=await function(t,e){return hs(t,"POST","/v2/accounts/mfaSignIn:start",cs(t,e))}(t,{mfaPendingCredential:e.credential,mfaEnrollmentId:i,phoneSignInInfo:{recaptchaToken:s}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:e}=await async function(t,e){return hs(t,"POST","/v1/accounts:sendVerificationCode",cs(t,e))}(t,{phoneNumber:r.phoneNumber,recaptchaToken:s});return e}}finally{i.qi()}}class jr{constructor(t){this.providerId=jr.PROVIDER_ID,this.auth=Vs(t)}verifyPhoneNumber(t,e){return Lr(this.auth,t,Li(e))}static credential(t,e){return Ys.Fi(t,e)}static credentialFromResult(t){const e=t;return jr.credentialFromTaggedObject(e)}static credentialFromError(t){return jr.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({Fe:t}){if(!t)return null;const{phoneNumber:e,temporaryProof:i}=t;return e&&i?Ys.xi(e,i):null}}function Ur(t,e){return e?Zn(e):(qn(t.hi,t,"argument-error"),t.hi)}jr.PROVIDER_ID="phone",jr.PHONE_SIGN_IN_METHOD="phone";class Br extends Hs{constructor(t){super("custom","custom"),this.params=t}Ti(t){return qs(t,this.Ki())}Ci(t,e){return qs(t,this.Ki(e))}Ei(t){return qs(t,this.Ki())}Ki(t){const e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}}function $r(t){return dr(t.auth,new Br(t),t.bypassAuthState)}function Wr(t){const{auth:e,user:i}=t;return qn(i,e,"internal-error"),lr(i,new Br(t),t.bypassAuthState)}async function Vr(t){const{auth:e,user:i}=t;return qn(i,e,"internal-error"),ur(i,new Br(t),t.bypassAuthState)}class Gr{constructor(t,e,i,n,s=!1){this.auth=t,this.resolver=i,this.user=n,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise((async(t,e)=>{this.pendingPromise={resolve:t,reject:e};try{this.eventManager=await this.resolver.di(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(t){this.reject(t)}}))}async onAuthEvent(t){const{urlResponse:e,sessionId:i,postBody:n,tenantId:s,error:r,type:o}=t;if(r)return void this.reject(r);const a={auth:this.auth,requestUri:e,sessionId:i,tenantId:s||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(t){this.reject(t)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return $r;case"linkViaPopup":case"linkViaRedirect":return Vr;case"reauthViaPopup":case"reauthViaRedirect":return Wr;default:Vn(this.auth,"internal-error")}}resolve(t){Xn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Xn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Hr=new ns(2e3,1e4);async function zr(t,e,i){const n=Vs(t);zn(t,e,tr);const s=Ur(n,i);return new Jr(n,"signInViaPopup",e,s).executeNotNull()}class Jr extends Gr{constructor(t,e,i,n,s){super(t,e,n,s),this.provider=i,this.authWindow=null,this.pollId=null,Jr.currentPopupAction&&Jr.currentPopupAction.cancel(),Jr.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return qn(t,this.auth,"internal-error"),t}async onExecution(){Xn(1===this.filter.length,"Popup operations only handle one event");const t=br();this.authWindow=await this.resolver.Xi(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver.Yi(this.auth).catch((t=>{this.reject(t)})),this.resolver.Zi(this.auth,(t=>{t||this.reject(Gn(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var t;return(null===(t=this.authWindow)||void 0===t?void 0:t.associatedEvent)||null}cancel(){this.reject(Gn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Jr.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e,i;(null===(i=null===(e=this.authWindow)||void 0===e?void 0:e.window)||void 0===i?void 0:i.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Gn(this.auth,"popup-closed-by-user"))}),2e3):this.pollId=window.setTimeout(t,Hr.get())};t()}}Jr.currentPopupAction=null;const qr=new Map;class Kr extends Gr{constructor(t,e,i=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,i),this.eventId=null}async execute(){let t=qr.get(this.auth.Ii());if(!t){try{const e=await async function(t,e){const i=Zr(e),n=Yr(t);if(!await n.Ze())return!1;const s="true"===await n.ti(i);return await n.ei(i),s}(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(e)}catch(e){t=()=>Promise.reject(e)}qr.set(this.auth.Ii(),t)}return this.bypassAuthState||qr.set(this.auth.Ii(),(()=>Promise.resolve(null))),t()}async onAuthEvent(t){if("signInViaRedirect"===t.type)return super.onAuthEvent(t);if("unknown"!==t.type){if(t.eventId){const e=await this.auth._i(t.eventId);if(e)return this.user=e,super.onAuthEvent(t);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Xr(t,e){qr.set(t.Ii(),e)}function Yr(t){return Zn(t.bi)}function Zr(t){return Es("pendingRedirect",t.config.apiKey,t.name)}async function Qr(t,e,i=!1){const n=Vs(t),s=Ur(n,e),r=new Kr(n,s,i),o=await r.execute();return o&&!i&&(delete o.user.Ke,await n.Ve(o.user),await n.mi(null,e)),o}class to{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach((i=>{this.isEventForConsumer(t,i)&&(e=!0,this.sendToConsumer(t,i),this.saveEventToCache(t))})),this.hasHandledPotentialRedirect||!function(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return io(t);default:return!1}}(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){var i;if(t.error&&!io(t)){const n=(null===(i=t.error.code)||void 0===i?void 0:i.split("auth/")[1])||"internal-error";e.onError(Gn(this.auth,n))}else e.onAuthEvent(t)}isEventForConsumer(t,e){const i=null===e.eventId||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&i}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(eo(t))}saveEventToCache(t){this.cachedEventUids.add(eo(t)),this.lastProcessedEventTime=Date.now()}}function eo(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter((t=>t)).join("-")}function io({type:t,error:e}){return"unknown"===t&&"auth/no-auth-event"===(null==e?void 0:e.code)}const no=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,so=/^https?/;async function ro(t){if(t.config.emulator)return;const{authorizedDomains:e}=await async function(t,e={}){return hs(t,"GET","/v1/projects",e)}(t);for(const t of e)try{if(oo(t))return}catch(t){}Vn(t,"unauthorized-domain")}function oo(t){const e=Qn(),{protocol:i,hostname:n}=new URL(e);if(t.startsWith("chrome-extension://")){const s=new URL(t);return""===s.hostname&&""===n?"chrome-extension:"===i&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):"chrome-extension:"===i&&s.hostname===n}if(!so.test(i))return!1;if(no.test(t))return n===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(n)}const ao=new ns(3e4,6e4);function co(){const t=Ir().Qi;if(null==t?void 0:t.H)for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}let ho=null;function uo(t){return ho=ho||function(t){return new Promise(((e,i)=>{var n,s,r;function o(){co(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{co(),i(Gn(t,"network-request-failed"))},timeout:ao.get()})}if(null===(s=null===(n=Ir().gapi)||void 0===n?void 0:n.iframes)||void 0===s?void 0:s.Iframe)e(gapi.iframes.getContext());else{if(!(null===(r=Ir().gapi)||void 0===r?void 0:r.load)){const e=xr("iframefcb");return Ir()[e]=()=>{gapi.load?o():i(Gn(t,"network-request-failed"))},Fr(`https://apis.google.com/js/api.js?onload=${e}`).catch((t=>i(t)))}o()}})).catch((t=>{throw ho=null,t}))}(t),ho}const lo=new ns(5e3,15e3),fo={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},po=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function vo(t){const e=t.config;qn(e.authDomain,t,"auth-domain-config-required");const i=e.emulator?ss(e,"emulator/auth/iframe"):`https://${t.config.authDomain}/__/auth/iframe`,n={apiKey:e.apiKey,appName:t.name,v:Tn},s=po.get(t.config.apiHost);s&&(n.eid=s);const r=t.Si();return r.length&&(n.fw=r.join(",")),`${i}?${Di(n).slice(1)}`}const go={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class mo{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(t){}}}function wo(t,e,i,n=500,s=600){const r=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString();let a="";const c=Object.assign(Object.assign({},go),{width:n.toString(),height:s.toString(),top:r,left:o}),h=Ci().toLowerCase();i&&(a=Ds(h)?"_blank":i),Ns(h)&&(e=e||"http://localhost",c.scrollbars="yes");const u=Object.entries(c).reduce(((t,[e,i])=>`${t}${e}=${i},`),"");if(function(t=Ci()){var e;return Ls(t)&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(h)&&"_self"!==a)return function(t,e){const i=document.createElement("a");i.href=t,i.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(n)}(e||"",a),new mo(null);const l=window.open(e||"",a,u);qn(l,t,"popup-blocked");try{l.focus()}catch(t){}return new mo(l)}const yo="__/auth/handler",bo="emulator/auth/handler";function _o(t,e,i,n,s,r){qn(t.config.authDomain,t,"auth-domain-config-required"),qn(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:i,redirectUrl:n,v:Tn,eventId:s};if(e instanceof tr){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[t,e]of Object.entries(r||{}))o[t]=e}if(e instanceof er){const t=e.getScopes().filter((t=>""!==t));t.length>0&&(o.scopes=t.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const t of Object.keys(a))void 0===a[t]&&delete a[t];return`${function({config:t}){if(!t.emulator)return`https://${t.authDomain}/${yo}`;return ss(t,bo)}(t)}?${Di(a).slice(1)}`}const Io="webStorageSupport";const ko=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this.bi=wr,this.gi=Qr,this.vi=Xr}async Xi(t,e,i,n){var s;Xn(null===(s=this.eventManagers[t.Ii()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()");return wo(t,_o(t,e,i,Qn(),n),br())}async tn(t,e,i,n){return await this.Yi(t),function(t){Ir().location.href=t}(_o(t,e,i,Qn(),n)),new Promise((()=>{}))}di(t){const e=t.Ii();if(this.eventManagers[e]){const{manager:t,promise:i}=this.eventManagers[e];return t?Promise.resolve(t):(Xn(i,"If manager is not set, promise should be"),i)}const i=this.initAndGetManager(t);return this.eventManagers[e]={promise:i},i.catch((()=>{delete this.eventManagers[e]})),i}async initAndGetManager(t){const e=await async function(t){const e=await uo(t),i=Ir().gapi;return qn(i,t,"internal-error"),e.open({where:document.body,url:vo(t),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:fo,dontclear:!0},(e=>new Promise((async(i,n)=>{await e.restyle({setHideOnLeave:!1});const s=Gn(t,"network-request-failed"),r=Ir().setTimeout((()=>{n(s)}),lo.get());function o(){Ir().clearTimeout(r),i(e)}e.ping(o).then(o,(()=>{n(s)}))}))))}(t),i=new to(t);return e.register("authEvent",(e=>{qn(null==e?void 0:e.authEvent,t,"invalid-auth-event");return{status:i.onEvent(e.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t.Ii()]={manager:i},this.iframes[t.Ii()]=e,i}Zi(t,e){this.iframes[t.Ii()].send(Io,{type:Io},(i=>{var n;const s=null===(n=null==i?void 0:i[0])||void 0===n?void 0:n.webStorageSupport;void 0!==s&&e(!!s),Vn(t,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}Yi(t){const e=t.Ii();return this.originValidationPromises[e]||(this.originValidationPromises[e]=ro(t)),this.originValidationPromises[e]}get li(){return Us()||Ps()||Ls()}};var So,To="@firebase/auth",Co="0.20.7";class Eo{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),(null===(t=this.auth.currentUser)||void 0===t?void 0:t.uid)||null}async getToken(t){if(this.assertAuthConfigured(),await this.auth.ci,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(t)}}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const e=this.auth.onIdTokenChanged((e=>{var i;t((null===(i=e)||void 0===i?void 0:i.stsTokenManager.accessToken)||null)}));this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){qn(this.auth.ci,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth.ze():this.auth.Je()}}function Ao(t=function(t="[DEFAULT]"){const e=wn.get(t);if(!e)throw kn.create("no-app",{appName:t});return e}()){const e=In(t,"auth");return e.isInitialized()?e.getImmediate():function(t,e){const i=In(t,"auth");if(i.isInitialized()){const t=i.getImmediate();if(Ni(i.getOptions(),null!=e?e:{}))return t;Vn(t,"already-initialized")}return i.initialize({options:e})}(t,{popupRedirectResolver:ko,persistence:[Rr,gr,wr]})}So="Browser",_n(new ji("auth",((t,{options:e})=>{const i=t.getProvider("app").getImmediate(),n=t.getProvider("heartbeat"),{apiKey:s,authDomain:r}=i.options;return((t,i)=>{qn(s&&!s.includes(":"),"invalid-api-key",{appName:t.name}),qn(!(null==r?void 0:r.includes(":")),"argument-error",{appName:t.name});const n={apiKey:s,authDomain:r,clientPlatform:So,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Bs(So)},o=new Ws(t,i,n);return function(t,e){const i=(null==e?void 0:e.persistence)||[],n=(Array.isArray(i)?i:[i]).map(Zn);(null==e?void 0:e.errorMap)&&t.yi(e.errorMap),t.ui(n,null==e?void 0:e.popupRedirectResolver)}(o,e),o})(i,n)}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((t,e,i)=>{t.getProvider("auth-internal").initialize()}))),_n(new ji("auth-internal",(t=>(t=>new Eo(t))(Vs(t.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),Cn(To,Co,function(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(So)),Cn(To,Co,"esm2017");var Oo;Cn("firebase","9.10.0","app"),function(t){t.SET_USER_LIST="setUserList",t.LOAD_INIT_DATA="loadInitData",t.SET_PAGE_TITLE="setPageTitle",t.ADD_GIF_MESSAGE="addGifMessage",t.SIDEBAR_MESSAGING_READY="sidebarMessagingReady",t.RESET_VIEW="resetView",t.HIDE_CHAT="hideChat",t.ON_UPDATE_SETTINGS="onUpdateSettings",t.PREVIEW_REACTION="previewReaction",t.UPDATE_SETTINGS="updateSettings",t.SET_REACTIONS_ACTIVE="setReactionsActive",t.ON_FOCUS="onSidebarFocus",t.SET_USER_ICON_URL="setUserIconUrl",t.ADD_MESSAGE="addMessage",t.CLEAR_MESSAGES="clearMessages",t.SET_PRESENCE_MESSAGE="setPresenceMessage",t.ON_PAGE_CLICK="onPageClick",t.ON_PURCHASE="onPurchase",t.DISPLAY_MODAL="displayModal",t.OPEN_TAB="openTab",t.ON_CHROME_STORAGE_UPDATE="onChromeStorageUpdate"}(Oo||(Oo={}));var No=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{c(n.next(t))}catch(t){r(t)}}function a(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){t.done?s(t.value):function(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(o,a)}c((n=n.apply(t,e||[])).next())}))};const Po=new class{constructor(){this.en=new Map,this.nn=Ze.WITH_ACTIVITY,this.app=function(t,e={}){"object"!=typeof e&&(e={name:e});const i=Object.assign({name:gn,automaticDataCollectionEnabled:!1},e),n=i.name;if("string"!=typeof n||!n)throw kn.create("bad-app-name",{appName:String(n)});const s=wn.get(n);if(s){if(Ni(t,s.options)&&Ni(i,s.config))return s;throw kn.create("duplicate-app",{appName:n})}const r=new $i(n);for(const t of yn.values())r.addComponent(t);const o=new Sn(t,i,r);return wn.set(n,o),o}(u),this.sn=[],this.updateStatus=t=>No(this,void 0,void 0,(function*(){var e;const i=yield null===(e=Ao().currentUser)||void 0===e?void 0:e.getIdToken();if(i)try{const e=yield E("user/@me/status","PATCH",!0,{status:t},i);console.log(e)}catch(t){console.log(t)}})),this.Pt=new yi,this.le(),this.rn();const t=function(t,e,i,n){return Li(t).onAuthStateChanged(e,i,n)}(Ao(),(e=>{e&&(this.an(),t())}));console.log("Background Script Loaded")}cn(){this.Pt.closeEventWindow()}hn(){this.cn();const t=window.open("https://redirect.teleparty.com/event-logger","Teleparty Logger","width=600,height=530,status=0,scrollbars=0,menubar=0");t&&this.Pt.setEventWindow(t)}de(t,e,i){var n,r,o,a,c,h,u,l,d,f,p,m,w,y,b,_,I,k,S,T;if(t.target===v){if(t.type==ti.CREATE_SESSION){const o=t;s()("Got create Session Message");const a=o.data;return 0===a.extensionTabData.id&&(a.extensionTabData.id=null!==(r=null===(n=e.tab)||void 0===n?void 0:n.id)&&void 0!==r?r:0),this.un(a).then(i).catch(this.ln(i,e.tab)),!0}if(t.type==Qe.GET_SESSION_DATA){const n=t;return this.dn(n.data,e).then(i).catch(this.ln(i,e.tab)),!0}if(t.type==Ye.TEARDOWN){const n=t;return this.pn(n,e).then(i),!0}if(t.type==Ye.LOG_EVENT){const n=t.data;if("eventType"in n)this.logOldEventAsync(n);else{let t;this.en.forEach((i=>{var n;i.chatTabId===(null===(n=e.tab)||void 0===n?void 0:n.id)&&(t=i.videoTabId)})),t?this.vn(t).then((t=>{this.ae(n,t)})):this.ae(n,e.tab)}return i(),!0}if(t.type==Ye.LOG_EXPERIMENT){const e=t;return this.logExperimentAsync(e.data),i(),!0}if(t.type==ti.RE_INJECT){const n=t;s()("Got Re Inject Message");const r=n.data;return 0===r.extensionTabData.id&&(r.extensionTabData.id=null!==(a=null===(o=e.tab)||void 0===o?void 0:o.id)&&void 0!==a?a:0),this.gn(r).then(i).catch(this.ln(i,e.tab)),!0}if(t.type==Ye.STAY_ALIVE){const e=t,n=e.data.tabId;return this.mn(n,e.data.persist),i(),!0}if(t.type==Ye.LOAD_CHAT_WINDOW){const t=null!==(h=null===(c=e.tab)||void 0===c?void 0:c.id)&&void 0!==h?h:0,n=null!==(l=null===(u=e.tab)||void 0===u?void 0:u.windowId)&&void 0!==l?l:0;return this.wn(t,n).then(i),!0}if(t.type==Ye.FULLSCREEN_WINDOW){const t=null!==(f=null===(d=e.tab)||void 0===d?void 0:d.windowId)&&void 0!==f?f:0;return console.log("Window ID is",t),this.fullScreen(t),!0}if(t.type==Ye.MAX_WINDOW){const t=null!==(m=null===(p=e.tab)||void 0===p?void 0:p.windowId)&&void 0!==m?m:0;return console.log("Window ID is",t),this.fullScreen(t,!1),!0}if(t.type==Ye.RESET_CHAT_WINDOW){const t=null!==(y=null===(w=e.tab)||void 0===w?void 0:w.id)&&void 0!==y?y:0;let n;return this.en.forEach((e=>{e.chatTabId!=t&&e.videoTabId!=t||(n=e)})),n&&this.yn(n).then(i),!0}if(t.type==Ye.HIDE_CHAT_WINDOW){const t=null!==(_=null===(b=e.tab)||void 0===b?void 0:b.id)&&void 0!==_?_:0;let n;return this.en.forEach((e=>{e.chatTabId!=t&&e.videoTabId!=t||(n=e)})),n&&this.bn(n).then(i),!0}if(t.type==ti.GET_INIT_USER_SESTTINGS)return this.getUserData().then((t=>{i(t)})).catch((t=>console.log(t))),!0;if(t.type==ti.GOOGLE_SIGN_IN)return this.doAuthSignIn().then(i),!0;if(t.type==Xe.SIGN_OUT)return this._n().then(i),!0;if(t.type==ti.GET_SCHEDULED_EVENTS)return this.In().then(i),!0;if(t.type==ti.GET_RECENT_SCHEDULED_EVENTS)return this.kn().then(i),!0;if(t.type===Xe.DO_AUTH_SIGN_IN)return this.doAuthSignIn().then(i),!0;if(t.type===Xe.GET_AUTH_TOKEN)this.Sn().then(i).catch(this.receiveMessageOnError(i));else{if(t.type===Ye.SET_USER_PRESENCE){const e=t;return this.setUserPresence(e.data).then(i).catch(this.receiveMessageOnError(i)),!0}if(t.type===Ye.TOGGLE_OPEN_PARTY){const n=t;return void 0===n.data.tabId&&(n.data.tabId=null===(I=e.tab)||void 0===I?void 0:I.id),this.Tn(n.data).then((t=>{console.log(t),i(t)})).catch(this.receiveMessageOnError(i)),!0}if(t.type===Ye.SET_ACTIVE_PARTY){const e=t;return this.Cn(e.data),i(),!0}if(t.type===Ye.GET_ACTIVE_PARTY){const t={sessionId:this.En};return i(t),!0}if(t.type===Ye.ACCEPT_DROPIN){const e=t;return this.An(e.data).then(i).catch(this.receiveMessageOnError(i)),!0}if(t.type===Ye.GET_TAB_ID)return i(null===(k=e.tab)||void 0===k?void 0:k.id),!0;if(t.type===Ye.SET_STATUS_TYPE){const e=t;return this.On(e.data).then(i).catch(i),!0}if(t.type===Ye.GET_STATUS_TYPE)return i(this.nn),!0;if(t.type===ti.SET_USER_STATUS)return this.updateStatus(t.data.status).then(i).catch(i),!0;if(t.type===Oo.OPEN_TAB){const{url:e}=t.data;chrome.tabs.create({url:e})}}}else if(t.target==g){const n=null!==(T=null===(S=e.tab)||void 0===S?void 0:S.id)&&void 0!==T?T:0;return de.sendMessageToTabAsync(t,n).then(i).catch(i),!0}}mn(t,e){let i;e||(i=setTimeout((()=>No(this,void 0,void 0,(function*(){this.Pt.removeAliveTab(t),yield this.Nn(t)}))),6e4)),this.Pt.addAliveTab(t,i)}gn(t){return No(this,void 0,void 0,(function*(){const e=t.extensionTabData;yield this.Pt.initContentScriptsAsync(e)}))}sendApiRequest(t,e,i,n){return No(this,void 0,void 0,(function*(){const s=`${p}/${t}`,r=new XMLHttpRequest;if(r.open(e,s),i){const t=Ao();if(!t.currentUser)throw new Error("Not signed in");{const e=yield t.currentUser.getIdToken();r.setRequestHeader("Authorization",`Bearer ${e}`),r.setRequestHeader("Content-Type","application/json")}}return new Promise(((t,e)=>{r.addEventListener("readystatechange",(()=>{if(r.readyState===XMLHttpRequest.DONE){const i=r.status;0===i||i>=200&&i<400?t(r.responseText):e(r.responseText)}})),r.send(JSON.stringify(n))}))}))}Pn(){var t;return No(this,void 0,void 0,(function*(){const e=yield Me.getItemsAsync(["extensionUses"]),i=null!==(t=e.extensionUses)&&void 0!==t?t:0;yield We.setItemsAsync({extensionUses:i+1})}))}destroyPresenceUpdateInterval(){this.presenceInterval&&(clearInterval(this.presenceInterval),this.presenceInterval=void 0)}updatePresenceState(){return No(this,void 0,void 0,(function*(){if(Ao().currentUser){const t=yield this.Pt.getOnlineState();t&&this.setUserPresence(t)}else this.destroyPresenceUpdateInterval()}))}updateMessageToken(){return No(this,void 0,void 0,(function*(){try{console.log("Token updated")}catch(t){console.log(t)}}))}Dn(){return No(this,void 0,void 0,(function*(){const t=JSON.parse(yield this.sendApiRequest("pending-party-requests","GET",!0,{})).find((t=>!t.sent&&"join"===t.type));t&&this.An({sessionId:t.sessionId})}))}Rn(){return No(this,void 0,void 0,(function*(){return!0}))}handlePushNotif(t){return No(this,void 0,void 0,(function*(){const e=t.data;if(e){const{type:t,tag:i,data:n}=e;if("notification_click"===t)console.log("Got Friend Request"),"friend"===i&&window.open(d,"Teleparty Friends","width=300,height=530,status=0,scrollbars=0,menubar=0");else if("notification_received"===t)try{const t=yield this.Pt.getActiveTabId();if(de.sendMessageToTabAsync(new ii(v,g,Ye.ON_NOTIF),t),"dropin_request"===n.type){(yield this.Rn())&&this.Dn()}}catch(t){console.log(t),console.log("No active tab?")}}}))}Fn(){let t="";return navigator.userAgent.includes("Firefox/")?t=`Firefox v${navigator.userAgent.split("Firefox/")[1]}`:navigator.userAgent.includes("Edg/")?t=`Edg v${navigator.userAgent.split("Edg/")[1]}`:navigator.userAgent.includes("Chrome/")&&(t=`Chrome v${navigator.userAgent.split("Chrome/")[1]}`),t}xn(){let t="";return-1!=navigator.userAgent.indexOf("Windows NT 10.0")&&(t="Windows 10"),-1!=navigator.userAgent.indexOf("Windows NT 6.3")&&(t="Windows 8.1"),-1!=navigator.userAgent.indexOf("Windows NT 6.2")&&(t="Windows 8"),-1!=navigator.userAgent.indexOf("Windows NT 6.1")&&(t="Windows 7"),-1!=navigator.userAgent.indexOf("Windows NT 6.0")&&(t="Windows Vista"),-1!=navigator.userAgent.indexOf("Windows NT 5.1")&&(t="Windows XP"),-1!=navigator.userAgent.indexOf("Windows NT 5.0")&&(t="Windows 2000"),-1!=navigator.userAgent.indexOf("Mac")&&(t="Mac/iOS"),-1!=navigator.userAgent.indexOf("X11")&&(t="UNIX"),-1!=navigator.userAgent.indexOf("Linux")&&(t="Linux"),t}Mn(t){const e=Ce.getSocketForTabId(t);return{id:null==e?void 0:e.getId(),transport:null==e?void 0:e.getTransport(),type:null==e?void 0:e.getType(),start_time_ms:null==e?void 0:e.getSocketStartTime()}}Ln(t,e){var i,n,s,r,o,a;return No(this,void 0,void 0,(function*(){const c=Object.assign({},t),h=Ce.getSocketForTabId(null!==(i=e.id)&&void 0!==i?i:0);if(h){const t=h.getCurrentSessionData();if(t&&t.sessionId){const e={id:null==t?void 0:t.sessionId,start_time_ms:null==t?void 0:t.created_at,member_type:(null==t?void 0:t.created)?"host":"participant"};c.party_session=e}const i=this.Mn(null!==(n=e.id)&&void 0!==n?n:0);i.id&&(c.socket_session=i);const u=this.Pt.getVideoSessionData();try{const t=yield this.jn(null!==(s=e.id)&&void 0!==s?s:0),i=t.videoState;c.page&&(c.page.is_adblock_enabled=t.is_adblock_enabled,c.page.is_chat_visible=t.is_chat_visible,c.page.is_player_fullscreen=t.is_player_fullscreen),u.status=i,u.video_ts_ms=t.video_ts_ms,u.party_ts_ms=t.party_ts_ms,t.content.service=null===(r=t.content.service)||void 0===r?void 0:r.toLowerCase(),t.content.episode_name=null===(o=t.content.episode_name)||void 0===o?void 0:o.toLowerCase(),t.content.name=null===(a=t.content.name)||void 0===a?void 0:a.toLowerCase(),c.screen=t.screen,c.content=t.content}catch(t){console.log(t)}(c.party_session&&c.party_session.id||c.name.startsWith("video_"))&&(c.video_session=u)}return c}))}Un(t){var e;const i=null===(e=window.navigator.userAgentData)||void 0===e?void 0:e.platform;return{name:"chrome",version:this.Fn(),type:"browser",manufacturer:i,model:"",os_name:this.xn(),os_version:"",install_id:t}}Bn(t,e,i,n){const s=this.Un(n),r=this.Pt.getAppSession(),o=Date.now(),a={name:"chrome_ext",version:chrome.runtime.getManifest().version},c=Object.assign({},e);return c.app||(c.app=a),c.app_session||(c.app_session=r),c.device=s,c.client_timestamp_ms=o,null==c.page&&(c.page=t),c.user=i,c}vn(t){return No(this,void 0,void 0,(function*(){return new Promise(((e,i)=>{try{chrome.tabs.get(t,(t=>{chrome.runtime.lastError?i(chrome.runtime.lastError):e(t)}))}catch(t){i(t)}}))}))}$n(t,e){return No(this,void 0,void 0,(function*(){return new Promise(((i,n)=>{try{chrome.tabs.update(t,{url:e},(()=>{i()}))}catch(t){n(t)}}))}))}Wn(t){return No(this,void 0,void 0,(function*(){const e=t.chatTabId;chrome.tabs.move(e,{index:-1,windowId:t.videoWindow.id},(e=>No(this,void 0,void 0,(function*(){var i;yield this.yn(t),chrome.tabs.update(null!==(i=e.id)&&void 0!==i?i:0,{active:!0})}))))}))}ue(t){return No(this,void 0,void 0,(function*(){let e;this.en.forEach((i=>{i.chatTabId===(null==t?void 0:t.id)&&(e=i)})),e&&t.url!==l&&this.Wn(e)}))}logEventForTabId(t,e){return No(this,void 0,void 0,(function*(){try{const i=yield this.vn(e);return this.ae(t,i)}catch(e){return this.ae(t)}}))}ae(t,e){var i,n,s,r,o;return No(this,void 0,void 0,(function*(){if(t.name.includes("error")){if(this.sn=this.sn.filter((t=>t>Date.now()-6e4)),this.sn.length>=15)return void console.log("Error rate limited");this.sn.push(Date.now())}let a=Object.assign({},t);try{const t=yield He.getValidatedChromeStorageDataAsync(),c=yield this.Vn(),h=["video_heartbeat"];this.Pt.incrementAppSessionEventNumber();const u={name:null!==(i=null==e?void 0:e.title)&&void 0!==i?i:"",url:null!==(n=null==e?void 0:e.url)&&void 0!==n?n:""},l=Ao(),d=null!==l.currentUser,f=yield this.Gn();let p,v;void 0===f||["canceled","unpaid","incomplete_expired"].includes(f.subscriptionStatus)||("trialing"===f.subscriptionStatus&&(v=!0),p="monthly"===f.subscriptionType?"premium_monthly":"premium_annual");const g={id:null!==(r=null===(s=l.currentUser)||void 0===s?void 0:s.uid)&&void 0!==r?r:c,name:t.userNickname,signed_in:d,plan:p,on_trial:v};a=this.Bn(u,a,g,c),a.component&&(a.component.type=null===(o=a.component.type)||void 0===o?void 0:o.toLowerCase()),"video_start"===a.name&&this.Pt.resetVideoSession(),"video_pause"===a.name&&this.Pt.pauseHeartBeat(),"video_resume"===a.name&&this.Pt.resumeHeartBeat(),h.includes(a.name)&&this.Pt.heartBeatProc(),e&&e.id&&(a=yield this.Ln(a,e))}catch(t){console.log("log event error : "+t)}this.Hn(a)}))}Hn(t){try{const e="https://metis.teleparty.com/v1/record",i=new XMLHttpRequest;i.open("PUT",e),i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify(t))}catch(t){console.error(t)}}openLogPage(){0}logOldEventAsync(t){return No(this,void 0,void 0,(function*(){try{const e={userId:yield this.Vn(),eventType:t.eventType,sessionId:t.sessionId};console.log("event: "+JSON.stringify(e));const i=new XMLHttpRequest;i.open("POST","https://data3.netflixparty.com/log-event"),i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify(e))}catch(t){console.log("log event error : "+t)}}))}pn(t,e){var i;return No(this,void 0,void 0,(function*(){if(e.tab&&e.tab.id){const n=e.tab.id;t.sender=v,t.target=g,yield de.sendMessageToTabAsync(t,n),yield this.Nn(n);const s=new ri(v,"Popup");de.At(s);const r=this.en.get(n);r&&((null===(i=null==r?void 0:r.chatWindow)||void 0===i?void 0:i.id)&&chrome.windows.remove(r.chatWindow.id),this.en.delete(n))}}))}zn(t){return No(this,void 0,void 0,(function*(){const e=yield He.getValidatedChromeStorageDataAsync(),i=(yield this.Jn(t)).getCurrentSessionData();if(i){const n={sessionCallbackData:i,storageData:e,isCreate:!1,showReviewMessage:this.qn(e)},s=new ni(v,g,n);yield this.sendMessageToTabAsync(t,s);const r={name:"video_fix",action:{description:"video session was restored after next video error"}};this.logEventForTabId(r,t)}}))}Kn(t){if(t.tab&&t.tab.id&&t.url){const e=t.tab.id;if(this.Pt.checkAliveTab(e))return this.Pt.removeAliveTab(e),void this.zn(e)}}dn(t,e){return No(this,void 0,void 0,(function*(){if(!(e.tab&&e.tab.id&&e.url))throw new Error("Invalid Request");{const i=e.url,n=e.tab.id;if(this.Pt.checkAliveTab(n))return this.Pt.removeAliveTab(n),void this.zn(n);const s=new z(new URL(i),n);yield this.Nn(n);const r=yield this.Xn(n);let o,a,c;if(r?(o=r.sessionId,a=r.videoType,c=r.serviceDomain,yield this.Yn(n)):o=s.sessionIdFromUrl,o){S(new URL(i))&&(s.videoId=t.videoId);const e={extensionTab:s,sessionId:o,videoType:a,serviceDomain:c};return yield this.Zn(e)}}}))}Qn(t){var e,i;return{userIcon:null!==(e=t.userIcon)&&void 0!==e?e:"",userNickname:null!==(i=t.userNickname)&&void 0!==i?i:"",nameColor:t.nameColor,badge:t.badge,reactions:t.reactions}}Zn(t){var e;return No(this,void 0,void 0,(function*(){const i=t.extensionTab,n=i.streamingService,s=yield this.Jn(i.id);s.clearSessionData();const r=yield He.getValidatedChromeStorageDataAsync(),o=yield s.getUserIdAsync(),a=r.userId?r.userId:o;r.userId||(yield this.ts(o),r.userId=o);const c=this.Qn(r),h=null!==(e=null==n?void 0:n.serverName)&&void 0!==e?e:"",u={videoId:i.videoId,sessionId:t.sessionId,videoService:h,permId:a,userSettings:c},l=yield new Promise((t=>{s.sendMessage(he.JOIN_SESSION,u,(e=>{t(e)}))})),d=Object.assign(Object.assign({},l),{userId:o,permId:a,videoService:h,videoType:t.videoType,serviceDomain:t.serviceDomain,userSettings:c,created:!1}),f=yield this.es(l,t.extensionTab.id,r,h);return s.loadSessionData(d,c),this.Cn({sessionId:l.sessionId,created:!1}),f}))}un(t){var e;return No(this,void 0,void 0,(function*(){const i=t.extensionTabData,n=i.streamingService,s=yield this.jn(i.id),r=yield this.Jn(i.id);r.clearSessionData();const o=yield He.getValidatedChromeStorageDataAsync(),a=yield r.getUserIdAsync(),c=o.userId?o.userId:a;o.userId||(yield this.ts(a),o.userId=a);const h=this.Qn(o),u=null!==(e=null==n?void 0:n.serverName)&&void 0!==e?e:"",l={controlLock:t.createSettings.controlLock,videoId:s.videoId,videoDuration:s.videoDuration,videoType:s.videoType,serviceDomain:s.serviceDomain,videoService:u,syncFromEnd:null==n?void 0:n.syncFromEnd,permId:c,userSettings:h},d=yield new Promise((t=>{r.sendMessage(he.CREATE_SESSION,l,(e=>{t(e)}))})),f=Object.assign(Object.assign({},d),{userId:a,permId:c,videoService:u,messages:[],created_at:Date.now(),videoType:s.videoType,serviceDomain:s.serviceDomain,userSettings:h,created:!1}),p=yield this.ns(d,i.id,o,u);return r.loadSessionData(f,h),p}))}Jn(t){return No(this,void 0,void 0,(function*(){const e=Ce.getSocketForTabId(t);if(e)return e;{const e=yield this.ss(t);return Ce.setSocketForTabId(t,e),e}}))}getUserData(){return No(this,void 0,void 0,(function*(){const t=yield this.rs(),e=Ao(),i=null!==e.currentUser,n=i?yield this.os():{status:0},s=yield this.Gn();return{userSettings:t,presence_data:n,signedIn:i,currentUser:e.currentUser,has_premium:void 0!==s&&!["canceled","unpaid","incomplete_expired"].includes(s.subscriptionStatus)}}))}rn(){return No(this,void 0,void 0,(function*(){const t=yield Me.getItemsAsync([Ke.STATUS_TYPE]);t[Ke.STATUS_TYPE]===Ze.NO_ACTIVITY?this.nn=Ze.NO_ACTIVITY:t[Ke.STATUS_TYPE]===Ze.OFFLINE?this.nn=Ze.OFFLINE:this.nn=Ze.WITH_ACTIVITY}))}On(t){return No(this,void 0,void 0,(function*(){this.nn=t,yield We.setItemsAsync({[Ke.STATUS_TYPE]:t}),yield this.updatePresenceState()}))}An(t){return No(this,void 0,void 0,(function*(){const e=Ce.getTabForSessionId(t.sessionId);void 0!==e&&chrome.tabs.update(e,{active:!0,highlighted:!0},(i=>No(this,void 0,void 0,(function*(){const n=null==i?void 0:i.url;if(n){const i={extensionTabData:new z(new URL(n),e),createSettings:{controlLock:!1},source:"dropin"};console.log("Creating dropin session"),yield this.un(i),this.removePartyInvite(t.sessionId)}else console.error("Couldn't get url, should message pass here")}))))}))}Cn(t){this.En=t.sessionId}updateBadgeCount(){return No(this,void 0,void 0,(function*(){const t=JSON.parse(yield this.sendApiRequest("friends","GET",!0,{})).filter((t=>void 0===t.sent)).filter((t=>{var e;return t.presence_data&&1!==(null===(e=t.presence_data)||void 0===e?void 0:e.status)}));t.length>0?chrome.browserAction.setBadgeText({text:`${t.length}`}):chrome.browserAction.setBadgeText({text:""}),chrome.browserAction.setBadgeBackgroundColor({color:"#5a5a5a"})}))}reToggleOpenParty(t){return No(this,void 0,void 0,(function*(){return this.Tn({open:!0,tabId:t})}))}Tn(t){return No(this,void 0,void 0,(function*(){if(!t.tabId)throw new Error("Invalid Tab Id");if(yield We.setItemsAsync({[Ke.DROPIN_KEY]:t.open}),t.open){const e=yield this.getSocketForTabAsync(t.tabId);if(e.sessionId)return e.dropInToggled=!0,!0;const i=yield He.getValidatedChromeStorageDataAsync(),n=yield e.getUserIdAsync(),s={permId:i.userId?i.userId:n,token:yield this.cs()},r=yield new Promise((t=>{e.sendMessage(he.CREATE_TEMP_SESSION,s,(e=>{t(e)}))}));if(!r||r.errorMessage)throw new Error(r?r.errorMessage:w);{const t=r.sessionId;e.tempSessionId=t,this.ht=t,e.dropInToggled=!0}console.log("Got temp session data: "+this.ht)}else{const e=Ce.getSocketForTabId(t.tabId);e&&(e.dropInToggled=!1,void 0===(null==e?void 0:e.sessionId)?Ce.removeSocketForTabId(t.tabId):e.tempSessionId=void 0)}return t.open}))}Nn(t){return No(this,void 0,void 0,(function*(){const e=Ce.getSocketForTabId(t);e&&(e.teardown(),Ce.removeSocketForTabId(t))}))}ss(t){return No(this,void 0,void 0,(function*(){const e=new Re(t);return yield e.createSocketForTab()}))}jn(t){return No(this,void 0,void 0,(function*(){const e=new ii(v,g,Ye.GET_VIDEO_DATA),i=yield de.sendMessageToTabAsync(e,t);if(i){if(i.error)throw new Error(i.error);return i}throw new Error("Failed to connect to Script. Please refresh the page and try again")}))}Xn(t){return No(this,void 0,void 0,(function*(){const e=qe.getRedirectDataForTabAsync(t);return qe.deleteRedirectDataForTabAsync(t),e}))}Yn(t){return No(this,void 0,void 0,(function*(){return qe.deleteRedirectDataForTabAsync(t)}))}Vn(){return No(this,void 0,void 0,(function*(){return new Promise(((t,e)=>{let i=0;const n=()=>No(this,void 0,void 0,(function*(){i++;const s=yield He.getValidatedChromeStorageDataAsync();s.userId?t(s.userId):i<5?setTimeout(n,5e3):e("Could not get permId in time")}));n()}))}))}ts(t){return No(this,void 0,void 0,(function*(){s()("No perm id found, using socket id"),yield We.setItemsAsync({userId:t})}))}setUserPresence(t){var e;return No(this,void 0,void 0,(function*(){t.status,t.status_text,t.description,t.session_id,t.service,yield null===(e=Ao().currentUser)||void 0===e?void 0:e.getIdToken()}))}cs(){return No(this,void 0,void 0,(function*(){return(yield this.Sn()).token}))}Sn(){return No(this,void 0,void 0,(function*(){const t=Ao();if(t.currentUser){return{token:yield t.currentUser.getIdToken()}}throw new Error("Not Signed In")}))}_n(){return No(this,void 0,void 0,(function*(){const t=Ao();yield t.signOut(),this.ae({name:"signout"})}))}an(){return No(this,void 0,void 0,(function*(){}))}hs(){return No(this,void 0,void 0,(function*(){return new Promise(((t,e)=>{chrome.windows.getAll((i=>{chrome.runtime.lastError&&e(chrome.runtime.lastError),t(i.filter((t=>"popup"===t.type)))}))}))}))}checkPopupWindow(){return No(this,void 0,void 0,(function*(){try{const t=yield this.hs();yield C(2e3)();const e=(yield this.hs()).filter((e=>null==t.find((t=>t.id===e.id))));if(e.length>0){const t=e[0];void 0!==t.tabs||t.focused||(yield this.us(t.id,{focused:!0}))}}catch(t){}}))}doAuthSignIn(){return No(this,void 0,void 0,(function*(){const t=new nr,e=Ao();if(e.currentUser)return!1;try{(yield Promise.all([zr(e,t),this.checkPopupWindow()]))&&(this.ae({name:"signin"}),yield this.an())}catch(t){console.log(t)}return!0}))}logExperimentAsync(t){return No(this,void 0,void 0,(function*(){try{const e={permId:yield this.Vn(),event:t.eventType,name:t.experimentName,version:t.experimentVersion};console.log("event: "+JSON.stringify(e));const i=new XMLHttpRequest;i.open("POST","https://data3.netflixparty.com/log-experiment"),i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify(e))}catch(t){console.log("log event error : "+t)}}))}qn(t){return void 0!==t.extensionUses&&(1===t.extensionUses||t.extensionUses%5==0)&&!t.reviewClicked}removePartyInvite(t){return No(this,void 0,void 0,(function*(){yield this.sendApiRequest("remove-party-invite","POST",!0,{sessionId:t})}))}ns(t,e,i,n,s){return No(this,void 0,void 0,(function*(){if(!t||t.errorMessage)throw this.Yn(e),new Error(t?t.errorMessage:w);{const r={sessionCallbackData:t,storageData:i,isCreate:!0,showReviewMessage:this.qn(i)},o=new ni(v,g,r);yield this.sendMessageToTabAsync(e,o);const a={eventType:"create-session-chrome"+(s?"-pc":""),sessionId:t.sessionId};this.logOldEventAsync(a);const c={name:"party_start",action:{description:n,reason:"session was created"}};return this.logEventForTabId(c,e),this.Pn(),{sessionId:t.sessionId,showReviewMessage:this.qn(i)}}}))}es(t,e,i,n){return No(this,void 0,void 0,(function*(){if(!t||t.errorMessage)throw this.Yn(e),new Error(t?t.errorMessage:"An error occured while trying to join the session. Please navigate to the party url and try again.");{const s={sessionCallbackData:t,storageData:i,isCreate:!1,showReviewMessage:this.qn(i)},r=new ni(v,g,s);yield this.sendMessageToTabAsync(e,r);const o={eventType:"join-session-chrome",sessionId:t.sessionId};this.logOldEventAsync(o);const a={name:"party_join",action:{description:n}};return this.logEventForTabId(a,e),this.Pn(),{sessionId:t.sessionId,showReviewMessage:this.qn(i)}}}))}getUserSettingsForStorageData(t){var e,i;return{userIcon:null!==(e=t.userIcon)&&void 0!==e?e:"",userNickname:null!==(i=t.userNickname)&&void 0!==i?i:""}}getSocketForTabAsync(t){return No(this,void 0,void 0,(function*(){const e=Ce.getSocketForTabId(t);if(e)return e;{const e=yield this.createSocketForTabAsync(t);return Ce.setSocketForTabId(t,e),e}}))}createSocketForTabAsync(t){return No(this,void 0,void 0,(function*(){return new Re(t).createSocketForTab()}))}us(t,e){return No(this,void 0,void 0,(function*(){return new Promise(((i,n)=>{chrome.windows.update(t,e,(t=>No(this,void 0,void 0,(function*(){chrome.runtime.lastError?n(chrome.runtime.lastError):(yield C(150)(),i(t))}))))}))}))}ls(t){return No(this,void 0,void 0,(function*(){return new Promise(((e,i)=>{chrome.windows.create(t,(t=>{chrome.runtime.lastError||void 0===t?i(chrome.runtime.lastError):e(t)}))}))}))}ds(t){return new Promise((e=>{chrome.windows.get(t,(t=>{chrome.runtime.lastError||void 0===t?e(!1):e(!0)}))}))}fs(t){return new Promise(((e,i)=>{chrome.tabs.query({windowId:t},(t=>{var n;chrome.runtime.lastError?i(chrome.runtime.lastError):e(null!==(n=t[0].id)&&void 0!==n?n:0)}))}))}ps(t){return new Promise((e=>{chrome.tabs.update(t,{active:!0},(()=>{e()}))}))}bn(t){return No(this,void 0,void 0,(function*(){const e=t.videoWindow;yield this.ps(t.videoTabId);let i=t.chatWindow;(yield this.ds(i.id))&&(i=yield this.us(i.id,{state:"minimized",focused:!1})),yield this.us(e.id,{state:"maximized"}),yield this.us(e.id,{focused:!0,width:window.screen.width,height:window.screen.height})}))}yn(t,e=0){var i;return No(this,void 0,void 0,(function*(){let n=t.videoWindow;yield this.ps(t.videoTabId),n=yield this.us(n.id,{state:"maximized"}),n=yield this.us(n.id,{state:"normal",width:window.screen.width-358,height:window.screen.availHeight,left:0,top:0,focused:!0});let s=t.chatWindow,r=!1;(yield this.ds(s.id))||(s=yield this.ls({url:l,type:"popup"}),r=!0);const o=yield this.fs(s.id);if(!r){const t=yield this.vn(o);void 0!==t.url&&t.url!==l&&(yield this.$n(o,l))}s=yield this.us(s.id,{state:"normal",width:y,height:window.screen.availHeight,left:window.screen.width-y,top:0,focused:!0});const a={chatWindow:s,videoWindow:n,chatTabId:o,videoTabId:t.videoTabId};this.en.set(t.videoTabId,a);const c=Ce.getSocketForTabId(t.videoTabId);if(c&&Ce.setSocketForTabId(o,c),console.log(n.width),e<2&&window.screen.width-(null!==(i=n.width)&&void 0!==i?i:0)<50)return console.log("Retry Reset"),this.yn(t,e+1)}))}fullScreen(t,e=!0){return No(this,void 0,void 0,(function*(){let i="fullscreen";e||(i="maximized"),yield this.us(t,{state:i})}))}wn(t,e){var i;return No(this,void 0,void 0,(function*(){const n=yield this.us(e,{state:"maximized"});yield this.us(n.id,{state:"normal",width:window.screen.width-358,height:window.screen.availHeight});const s=yield this.ls({url:l,type:"popup",state:"maximized"});if(yield this.us(s.id,{state:"normal",width:y,height:window.screen.availHeight,left:window.screen.width-y,top:0}),!s||!n)throw new Error("Failed to Create Party View");{const e=s.tabs&&null!==(i=s.tabs[0].id)&&void 0!==i?i:0,r={chatWindow:s,videoWindow:n,chatTabId:e,videoTabId:t};this.en.set(t,r);const o=Ce.getSocketForTabId(r.videoTabId);o&&Ce.setSocketForTabId(e,o)}}))}waitForPermId(){return No(this,void 0,void 0,(function*(){return new Promise(((t,e)=>{let i=0;const n=()=>No(this,void 0,void 0,(function*(){i++;const s=yield He.getValidatedChromeStorageDataAsync();s.userId?t(s.userId):i<5?setTimeout(n,5e3):e("Could not get permId in time")}));n()}))}))}ln(t,e){return i=>{this.vs(i.message,e),t({error:i.message})}}vs(t,e,i){const n={name:"error",action:{reason:t,description:i}};this.ae(n,e),s()("An error occured: "+i+t)}le(){chrome.runtime.onSuspend.addListener((()=>{Ce.teardown()})),chrome.tabs.onRemoved.addListener(this.gs.bind(this)),chrome.runtime.onMessage.addListener(this.de.bind(this)),this.ys(),new bi}gs(t){return No(this,void 0,void 0,(function*(){let e=!1;try{yield this.vn(t);e=!0}catch(t){}const i=Ce.getSocketForTabId(t);if(i&&(!e||!this.Pt.checkAliveTab(t))){const e={name:"tab_close",action:{description:"tab was closed with socket",source:"tabID: "+t}};this.logEventForTabId(e,t),s()("Detected Tab Close: Disconnecting socket for tab: "+t),i.teardown(),Ce.removeSocketForTabId(t)}}))}ys(){chrome.runtime.onConnect.addListener((t=>{var e,i;const n=null===(i=null===(e=t.sender)||void 0===e?void 0:e.tab)||void 0===i?void 0:i.id;if(n){s()("Connected to Content Script with Tab ID: "+n);try{t.postMessage("pong"),t.onDisconnect.addListener((()=>{console.log("Detected port disconnect: "+n),this.gs(n)}))}catch(t){}}}))}Wt(t){try{We.setItemsAsync(t)}catch(t){this.logError("Update chrome Storage Data Failed "+t)}}sendMessageToTabAsync(t,e,i){return No(this,void 0,void 0,(function*(){return new Promise(((n,s)=>{let r;i&&(r=setTimeout((()=>{s(new Error("Could not get a response from the page in time. Please refresh the page and try again."))}),i)),chrome.tabs.sendMessage(t,e,(t=>{r&&clearTimeout(r),n(t)}))}))}))}receiveMessageOnError(t){return e=>{this.logError(e.message),t({error:e.message})}}logError(t){s()("An error occured: "+t)}In(){return new Promise(((t,e)=>{fetch(`${c}/events`,{credentials:"include"}).then((i=>No(this,void 0,void 0,(function*(){i.ok?t(yield i.json()):e(yield i.json())})))).catch((t=>{e(t)}))}))}kn(){return new Promise(((t,e)=>{fetch(`${c}/recent_events`,{credentials:"include"}).then((i=>No(this,void 0,void 0,(function*(){i.ok?t(yield i.json()):e(yield i.json())})))).catch((t=>{e(t)}))}))}Gn(){var t;return No(this,void 0,void 0,(function*(){const e=yield null===(t=Ao().currentUser)||void 0===t?void 0:t.getIdToken();if(e)try{return JSON.parse(yield E("subscription","GET",!0,{},e))}catch(t){}}))}os(){var t;return No(this,void 0,void 0,(function*(){yield null===(t=Ao().currentUser)||void 0===t?void 0:t.getIdToken();return{status:0}}))}rs(){return No(this,void 0,void 0,(function*(){const t=yield He.getValidatedChromeStorageDataAsync();return this.getUserSettingsForStorageData(t)}))}},Do=Po;window.teleparty=Po})()})();